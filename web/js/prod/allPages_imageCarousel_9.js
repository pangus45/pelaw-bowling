gCarouselsPaused=false;$(document).ready(function(){$(window).focus(function(){carouselReset();l("focus")});$(window).blur(function(){allCarouselsStop();l("blur")})});function carouselStripImageLoadCheck(pBlock){var imageWrapper=pBlock.find(".carouselImageWrapper");var strip=pBlock.find(".carouselStripWrapper");var images=strip.find(".carouselStripThumbnail");$(images).each(function(pIndex){var stripImage=$(this);stripImage.css("opacity",0);var index=stripImage.data("index");var carouselImage=imageWrapper.find(".carouselImage").eq(pIndex);var dataAttr="image-src-staggered";var src=carouselImage.data(dataAttr);if(!src){dataAttr="imagesrc";src=carouselImage.data(dataAttr)}imageLoadCallbackRegister(carouselImage,function(){l("loaded strip image "+pIndex);stripImage.css("background-image","url("+src+")");TweenMax.to(stripImage,.5,{opacity:1})})})}function carouselStripInit(pCarouselStrip){l("Carousel strip init");var block=domClimbTo(pCarouselStrip,".block-carousel");var imageWrapper=block.find(".carouselImageWrapper");pCarouselStrip.data("first",0);pCarouselStrip.find(".carouselStripThumbnail,.navButton").unbind();carouselStripImageLoadCheck(block);var stripImages=pCarouselStrip.find(".carouselStripThumbnail");$(stripImages).click(function(pIndex){var image=$(this);stripImages.removeClass("selected");image.addClass("selected");var index=image.data("index");carouselManualSlideToPos(imageWrapper,index)});var nextButton=pCarouselStrip.find(".nextButton");var prevButton=pCarouselStrip.find(".previousButton");carouselThumbnailStripNavButtonsActiveSet(pCarouselStrip);$(nextButton).click(function(pIndex){var button=$(this);var oldFirst=pCarouselStrip.data("first");var visibleItems=pCarouselStrip.data("strip-items");var totalItems=stripImages.length;var maxFirst=Math.max(0,totalItems-visibleItems);var newFirst=Math.min(oldFirst+visibleItems,maxFirst);carouselThumbnailStripPosSet(pCarouselStrip,newFirst);carouselThumbnailStripNavButtonsActiveSet(pCarouselStrip)});$(prevButton).click(function(pIndex){var button=$(this);var oldFirst=pCarouselStrip.data("first");var visibleItems=pCarouselStrip.data("strip-items");var totalItems=stripImages.length;var newFirst=oldFirst-visibleItems;newFirst=Math.max(0,newFirst);carouselThumbnailStripPosSet(pCarouselStrip,newFirst);carouselThumbnailStripNavButtonsActiveSet(pCarouselStrip)})}function carouselManualSlideToPos(pWrapper,pPos){carouselAnimateToPos(pWrapper,pPos);carouselAutoSlideStop(pWrapper)}function carouselThumbnailStripNavButtonsActiveSet(pStrip){var first=pStrip.data("first");var visibleItems=pStrip.data("strip-items");var images=pStrip.find(".carouselStripThumbnail");var totalItems=images.length;var maxFirst=Math.max(0,totalItems-visibleItems);var prevButton=pStrip.find(".previousButton");var nextButton=pStrip.find(".nextButton");prevButton.removeClass("disabled");nextButton.removeClass("disabled");if(first==0){prevButton.addClass("disabled")}if(first>=maxFirst){nextButton.addClass("disabled")}}function carouselThumbnailStripPosSet(pCarouselStrip,pFirstIndex){var visibleItems=pCarouselStrip.data("strip-items");var images=pCarouselStrip.find(".carouselStripThumbnail");$(images).each(function(pIndex){var image=$(this);if(pIndex>=pFirstIndex&&pIndex<pFirstIndex+visibleItems){image.show()}else{image.hide()}});pCarouselStrip.data("first",pFirstIndex)}function carouselAutoSlideStop(pImageWrapper){clearInterval(pImageWrapper.data("intervalId"))}function imageCarouselStripsInit(){var strips=$(".block-carousel .carouselStripWrapper");$(strips).each(function(pIndex){carouselStripInit($(this))})}function imageCarouselsDotsInit(){$(".block-carousel").each(function(){imageCarouselDotsInit($(this))})}function imageCarouselDotsInit(pBlock){l("imageCarouselDotsInit",pBlock.attr("id"));var dots=pBlock.find(".carouselDot");dots.unbind();dots.click(function(){var dot=$(this);var imageWrapper=dot.parent().parent().find(".carouselImageWrapper");var index=dot.prevAll().length;carouselAnimateToPos(imageWrapper,index);carouselAutoSlideStop(imageWrapper)});var images=pBlock.find(".carouselImage");$(images).each(function(pImageIndex){var image=$(this);l("dots registering callback for "+pImageIndex);imageLoadCallbackRegister(image,function(){l("Dots check - image loaded "+pImageIndex);dots.eq(pImageIndex).data("activated",true);$(dots).each(function(pDotIndex){var dot=$(this);if(dot.data("activated")){if(!dot.data("faded")){TweenMax.to(dot,.5,{opacity:1});dot.data("faded",true)}return true}return false})})})}function allCarouselsStop(){var imageWrappers=$(".block-carousel .carouselImageWrapper");imageWrappers.each(function(){clearInterval(imageWrappers.data("intervalId"))})}function carouselReset(){var imageWrappers=$(".block-carousel .carouselImageWrapper");if(0==imageWrappers.length){return}imageWrappers.each(function(){var wrapper=$(this);var tween=wrapper.data("tween");if(tween){tween.kill();wrapper.removeData("tween")}});TweenLite.set(imageWrappers,{x:0});carouselsInit()}function carouselsInit(){imageCarouselsDotsInit();imageCarouselStripsInit();var imageWrappers=$(".block-carousel .carouselImageWrapper");imageWrappers.each(function(){var wrapper=$(this);wrapper.data("imageCount",wrapper.find(".carouselImage").length);wrapper.data("pos",0);carouselNextPrevButtonsInit(wrapper)});imageWrappers.each(function(){var wrapper=$(this);var intervalTimeMs=wrapper.attr("data-interval")*1e3;intervalTimeMs+=wrapper.attr("data-duration")*1e3;var previousInterval=wrapper.data("intervalId");if(previousInterval){clearInterval(previousInterval)}var interval=setInterval(function(){if(timeSinceLastScrollMsGet()<1e3){return}var images=wrapper.find(".carouselImage");var nextImageIndex=wrapper.data("pos")+1;if(nextImageIndex==images.length){nextImageIndex=0}var nextImage=images.eq(nextImageIndex);if(imageIsLoaded(nextImage)){console.log("Image loaded - animating");carouselAnimateToPos(wrapper,wrapper.data("pos")+1)}else{console.log("Image not loaded - will try again soon")}},intervalTimeMs);wrapper.data("intervalId",interval)})}function carouselNextPrevButtonsInit(pWrapper){var block=pWrapper.parent();block.find(".leftRightButton").unbind();block.find(".leftButton").click(function(){carouselManualSlideToPos(pWrapper,pWrapper.data("pos")-1)});block.find(".rightButton").click(function(){carouselManualSlideToPos(pWrapper,pWrapper.data("pos")+1)})}function carouselAnimateToPos(pImageWrapper,pPos){var duration=pImageWrapper.data("duration");var dots=pImageWrapper.parent().parent().find(".carouselDot");dots.removeClass("current");var width=pImageWrapper.width();var images=pImageWrapper.find(".carouselImage");if(pPos==images.length){pImageWrapper.append(images.eq(0).clone(true,true));images=pImageWrapper.find(".carouselImage");dots.eq(0).addClass("current")}else{dots.eq(pPos).addClass("current")}var image=images.eq(pPos);var translation=image.position().left+image.width()*.01;l("position",image.position().left);l("offset",image.offset().left);var tween=TweenLite.to(pImageWrapper,duration,{x:-translation,onComplete:function(){var imageCount=pImageWrapper.data("imageCount");if(images.length>imageCount){images.slice(imageCount).remove();TweenLite.set(pImageWrapper,{x:0});pImageWrapper.data("pos",0)}pImageWrapper.removeData("tween")}});pImageWrapper.data("pos",pPos);pImageWrapper.data("tween",tween)}