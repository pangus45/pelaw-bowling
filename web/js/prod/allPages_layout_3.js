var VIDEO_ASPECT_RATIO=.5625;var gFB_RESIZE_DELAY=1e3;var gFBResizeInterval=null;var gCarouselResizeFlag=false;var gPreviousScreenWidth=0;var gPreviousScreenHeight=0;$(document).ready(function(){responsiveInit();videosResize();carouselsInit();slideshowInit();animatedGradientsInit();clickThroughsInit();facebookRefresh();togglesInit();$(window).resize(layoutResize);$(window).scroll(layoutScroll);parallaxUpdate();attachedRowsUpdate();setInterval(function(){facebookRefresh(true)},100)});function backgroundParallaxUpdate(){var scrollTop=$(window).scrollTop();var screenHeight=$(window).height();var screenBottom=scrollTop+screenHeight;$("[data-background-parallax-velocity]").each(function(){var row=$(this);if(!row.data("initialBackgroundPositionY")){row.data("initialBackgroundPositionY",row.css("background-position-y"))}var rowTop=row.offset().top;var rowHeight=row.outerHeight();var rowBottom=rowTop+rowHeight;var initialY=row.data("initialBackgroundPositionY");if(rowTop<screenBottom){var velocity=row.data("background-parallax-velocity");var rowEntryPoint=rowTop-screenHeight;rowEntryPoint=Math.max(0,rowEntryPoint);var rowExitPoint=rowBottom;var scrollTopMax=$(document).height()-screenHeight;rowExitPoint=Math.min(scrollTopMax,rowExitPoint);var progressInPx=scrollTop-rowEntryPoint;var progressFraction=progressInPx/(rowExitPoint-rowEntryPoint);var backgroundSize=row.css("background-size");if(-1!=backgroundSize.indexOf("%")&&parseFloat(backgroundSize)<100){}if(velocity<0){var invertedFraction=1-progressFraction*-velocity;var backgroundY=Math.round(invertedFraction*100)}else{var backgroundY=Math.round(progressFraction*100*velocity)}var offset=backgroundPositionConvertToNumber(initialY);if(-1!=offset.indexOf("%")){backgroundY+=parseFloat(offset)}else{var percentage=parseFloat(offset)/rowHeight*100;backgroundY+=percentage}console.log(row.attr("id")+": "+"Y:"+backgroundY);row.css("background-position-y",backgroundY+"%")}})}function rowParallaxUpdate(){if(mobileLayout()){return}var scrollTop=$(window).scrollTop();var screenHeight=$(window).height();var screenBottom=scrollTop+screenHeight;$("[data-row-parallax-velocity]").each(function(){var row=$(this);var initialTop=row.data("row-top");var pauseAt=row.data("row-pause-at");var velocity=row.data("row-parallax-velocity");var scrollTopMax=$("#bodyInner").outerHeight()-screenHeight;var progressFraction=scrollTop/scrollTopMax;var displacementInPx=progressFraction*velocity*scrollTopMax;console.log("Desktop Layout: "+$("#bodyInner").outerHeight());console.log("Progress: "+progressFraction);console.log("Displacement: "+displacementInPx);if(-1!=initialTop.indexOf("vh")||-1!=initialTop.indexOf("%")){var startPosInPx=parseFloat(initialTop)*screenHeight/100}else{var startPosInPx=parseFloat(initialTop)}var actualScreenPosInPx=startPosInPx+displacementInPx;console.log("Screen Pos: "+actualScreenPosInPx);if("undefined"!==typeof pauseAt){var pauseAtInPx=parseFloat(pauseAt)*screenHeight/100;var diff=actualScreenPosInPx-pauseAtInPx;console.log("Diff: "+diff);console.log("Pause at in px: "+pauseAtInPx);if(velocity>0&&diff>0){displacementInPx=displacementInPx-diff}else if(velocity<0&&diff<0){displacementInPx=displacementInPx-diff}}TweenLite.set(row,{y:displacementInPx+"px"})})}function parallaxUpdate(){backgroundParallaxUpdate();rowParallaxUpdate()}function attachedRowsUpdate(){$("[data-attached-to-row]").each(function(){var row=$(this);var attachedToRowName=row.data("attached-to-row");var attachedToRow=$('[data-row-name="'+attachedToRowName+'"]');if(attachedToRow.length>0){var attachedToRowBottom=parseInt(attachedToRow.css("top"))+attachedToRow.height();row.css("top",attachedToRowBottom);var transform=attachedToRow.css("transform");TweenLite.set(row,{transform:transform})}})}function backgroundPositionConvertToNumber(pPosition){if("center"==pPosition){return"50%"}else if("top"==pPosition){return"0%"}else if("bottom"==pPosition){return"100%"}return pPosition}function editorIsActive(){return typeof gEditorLoaded!=="undefined"}function togglesInit(){$("[class]").each(function(){var element=$(this);var classAttr=element.attr("class");if(!classAttr){return true}var classes=classAttr.split(" ");$.each(classes,function(pIndex,pClass){if(-1!=pClass.indexOf("toggle-")){var targetClass=pClass.substr(7);var targetElement=$("."+targetClass);if(targetElement.length>0){var elementAndDescendants=element.find("*");elementAndDescendants.addClass("clickable");if(!editorIsActive()){var url=location.href;var hide=true;if(-1!=url.indexOf("#")){var parts=url.split("#");var linkSelector="#"+parts[parts.length-1];if(targetClass==parts[parts.length-1]){hide=false}}if(hide){targetElement.hide()}}elementAndDescendants.click(function(){targetElement.css("opacity",1);targetElement.slideToggle();return false})}}})})}function layoutScroll(){parallaxUpdate();attachedRowsUpdate()}function clickThroughsInit(){$(".clickThrough").on("click touchstart",function(pEvent){var clickedElement=$(this);var elementBehind=inputBehindGet(pEvent,clickedElement);if(elementBehind){if(elementBehind.is("button")){var form=domClimbTo(elementBehind,"form");elementBehind.trigger(pEvent.type)}else{elementBehind.focus()}}});$(".clickThrough").mousemove(function(pEvent){var element=$(this);clickThroughCursorCheck(pEvent,element)})}function clickThroughCursorCheck(pEvent,pElement){var clickableElements="input, select, button, textarea, label";var inputBehind=inputBehindGet(pEvent,pElement);if(inputBehind.is(clickableElements)){if(inputBehind.is("button")){pElement.css("cursor","pointer");inputBehind.addClass("clickThroughHover");console.log(pElement.attr("class"))}else{pElement.css("cursor","text");$(".clickThroughHover").removeClass("clickThroughHover")}}else{pElement.css("cursor","default");$(".clickThroughHover").removeClass("clickThroughHover")}}function inputBehindGet(pEvent,pElement){console.log(pElement.attr("class"));var rowWrapper=domClimbTo(pElement,".rowWrapper");rowWrapper.hide();if("touchstart"==pEvent.type){pEvent=pEvent.originalEvent.touches[0]}var elementBehind=$(document.elementFromPoint(pEvent.clientX,pEvent.clientY));rowWrapper.show();var clickableElements="input, select, button, textarea, label";if(elementBehind.length==0){return null}return elementBehind}function animatedGradientsInit(){$("[data-animatedGradientColours]").each(function(){var element=$(this);var coloursAttribute=element.attr("data-animatedGradientColours");var colours=$.parseJSON(coloursAttribute);if(colours.length<4){return true}element.data("animatedGradientStep",0);element.data("animatedGradientIndices",[0,1,2,3]);if(element.data("interval")){clearInterval(interval)}var interval=setInterval(function(){updateGradient(element)},10);element.data("interval",interval)})}function updateGradient(pElement){var step=pElement.data("animatedGradientStep");var colourIndices=pElement.data("animatedGradientIndices");var coloursAttribute=pElement.attr("data-animatedGradientColours");var speedAttribute=pElement.attr("data-animatedGradientSpeed");var gradientSpeed=parseFloat(speedAttribute)/1e3;var hexColours=$.parseJSON(coloursAttribute);var rgbaColours=[];$.each(hexColours,function(pIndex,pColour){var rgbColour=hexToRgb(pColour);rgbaColours.push(rgbColour)});if(!colourIndices){return}var c0_0=rgbaColours[colourIndices[0]];var c0_1=rgbaColours[colourIndices[1]];var c1_0=rgbaColours[colourIndices[2]];var c1_1=rgbaColours[colourIndices[3]];var istep=1-step;var r1=Math.round(istep*c0_0[0]+step*c0_1[0]);var g1=Math.round(istep*c0_0[1]+step*c0_1[1]);var b1=Math.round(istep*c0_0[2]+step*c0_1[2]);var color1="rgb("+r1+","+g1+","+b1+")";var r2=Math.round(istep*c1_0[0]+step*c1_1[0]);var g2=Math.round(istep*c1_0[1]+step*c1_1[1]);var b2=Math.round(istep*c1_0[2]+step*c1_1[2]);var color2="rgb("+r2+","+g2+","+b2+")";pElement.css({background:"-webkit-gradient(linear, left top, right top, from("+color1+"), to("+color2+"))"}).css({background:"-moz-linear-gradient(left, "+color1+" 0%, "+color2+" 100%)"});step+=gradientSpeed;if(step>=1){step%=1;colourIndices[0]=colourIndices[1];colourIndices[2]=colourIndices[3];colourIndices[1]=(colourIndices[1]+Math.floor(1+Math.random()*(rgbaColours.length-1)))%rgbaColours.length;colourIndices[3]=(colourIndices[3]+Math.floor(1+Math.random()*(rgbaColours.length-1)))%rgbaColours.length}pElement.data("animatedGradientStep",step);pElement.data("animatedGradientIndices",colourIndices)}function flexSet(pElement,pFlexValue){pElement.css("flex",pFlexValue);pElement.css("-webkit-box-flex",pFlexValue);pElement.css("-moz-box-flex",pFlexValue);pElement.css("-webkit-flex",pFlexValue);pElement.css("-ms-flex",pFlexValue)}function layoutResize(){console.log("Layout Resize");if($(window).width()==gPreviousScreenWidth&&$(window).height()==gPreviousScreenHeight){return}gPreviousScreenWidth=$(window).width();gPreviousScreenHeight=$(window).height();responsiveRefresh();videosResize();facebookRefresh();carouselReset();attachedRowsUpdate();gCarouselResizeFlag=true}function responsiveInit(){$(".flexRow").each(function(){var row=$(this);var firstColumn=row.find(".flexColumn");var margin=firstColumn.css("margin-right");row.data("originalMargin",firstColumn.css("margin-right"))});responsiveRefresh()}function responsiveRefresh(){$("[data-hide]").each(function(){var element=$(this);var hide=htmlDecode(element.attr("data-hide"));var screenWidth=$(window).width();if("<="==hide.substr(0,2)){var number=hide.substr(2);if(screenWidth<=number){elementHideResponsive(element)}else{elementShowResponsive(element)}}else if("<"==hide.substr(0,1)){var number=hide.substr(1);if(screenWidth<number){elementHideResponsive(element)}else{elementShowResponsive(element)}}else if(">="==hide.substr(0,2)){var number=hide.substr(2);if(screenWidth>=number){elementHideResponsive(element)}else{elementShowResponsive(element)}}else if(">"==hide.substr(0,1)){var number=hide.substr(1);if(screenWidth>number){elementHideResponsive(element)}else{elementShowResponsive(element)}}});rolloversRefreshWhenReady()}function rolloversRefreshWhenReady(){if(typeof rolloversRefresh!==typeof undefined){rolloversRefresh()}else{setTimeout(rolloversRefreshWhenReady,1e3)}}function elementShowResponsive(pElement){originalDisplayStore(pElement);var display=pElement.data("originalDisplay");pElement.css("display",display);pElement.find(".layoutSquare").data("responsiveHidden",false);rowMarginsRefresh()}function originalDisplayStore(pElement){var originalDisplay=pElement.data("originalDisplay");if(!originalDisplay){pElement.data("originalDisplay",pElement.css("display"))}}function elementHideResponsive(pElement){originalDisplayStore(pElement);pElement.css("display","none");pElement.data("responsiveHidden",true);pElement.find(".layoutSquare").data("responsiveHidden",true);rowMarginsRefresh();console.l}function rowMarginsRefresh(){$(".flexRow").each(function(){var row=$(this);var columns=row.children();if(columns.length<=1){return true}columns.each(function(pIndex,pColumn){var column=$(this);var margin=row.data("originalMargin");if(0==pIndex){column.css("margin-right",margin)}else if(columns.length-1==pIndex){column.css("margin-left",margin)}else{column.css("margin-left",margin);column.css("margin-right",margin)}})})}function mobileLayout(){return"right"==$("#layoutMediaQuery").css("float")}function desktopLayout(){return"left"==$("#layoutMediaQuery").css("float")}function slideshowInit(){if(browserIsIE()){}gSlideshowInterval=setTimeout(function(){$(".block-slideshow").each(function(){var block=$(this);var timeline=block.data("timeline");if(timeline){timeline.kill()}nextSlideshowImageAnimateRecursive(block,block.find(".slideShowImage").last(),true)})},3e3)}function nextSlideshowImageAnimateRecursive(pBlock,pImage,pFirst){var elementId=pBlock.attr("data-id");var interval=gElementData[elementId];var timeline=new TimelineLite;pBlock.data("timeline",timeline);var callback=function(){var prevImage=pImage.prev();if(!prevImage.is("script")){prevImage.css("opacity",1);nextSlideshowImageAnimateRecursive(pBlock,prevImage,false)}};if(pFirst){if(browserIsIE()){timeline.to(pImage,interval*.9,{onComplete:callback})}else{timeline.to(pImage,interval*.9,{scale:1.2,rotation:.01,onComplete:callback,ease:Power0.easeNone})}}else{if(browserIsIE()){timeline.to(pImage,interval*.9,{onComplete:callback})}else{timeline.to(pImage,interval*.1,{scale:1.1,rotation:.01});timeline.to(pImage,interval*.8,{scale:1.2,rotation:.01,ease:Power0.easeNone,onComplete:callback})}}var opacityTransition=.1;if(browserIsIE()){opacityTransition=.5}timeline.to(pImage,interval*opacityTransition,{opacity:0,onComplete:function(){pBlock.find("script").after(pImage);TweenLite.set(pImage,{scale:1,rotation:.01})}})}function facebookRefresh(pScroll){var facebookBlocks=$(".desktopLayout .block-facebook");if(mobileLayout()){var facebookBlocks=$(".mobileLayout .block-facebook")}facebookBlocks.each(function(){var block=$(this);var row=domClimbTo(block,".flexRow");var column=domClimbTo(block,".flexColumn");if(!elementIsInViewport(block)){return}var elementId=block.attr("data-id");var data=gElementData[elementId];var urlEnd=data.url;if(""==urlEnd){return}var previousIFrame=block.find("iframe");if(previousIFrame.length>0&&pScroll){return}block.empty();var width=parseInt(block.innerWidth());width=Math.min(width,500);var height=500;if(column){var heightPercentage=parseFloat(data.height);var height=column.height()*heightPercentage/100}height=parseInt(height);var baseUrl="https://www.facebook.com/plugins/page.php";var params="href=https%3A%2F%2Fwww.facebook.com%2F"+urlEnd+"&width="+width+"&height="+height+"&tabs=timeline&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId=390487257738943";var widthAttr='width="'+width+'" ';var heightAttr='height="'+height+'" ';var attr=widthAttr+heightAttr+'style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"';var iframe=$('<iframe src="'+baseUrl+"?"+params+'" '+attr+"></iframe>");block.append(iframe);iframe.data("currentWidth",width);iframe.data("currentHeight",height)})}function carouselDotsInit(){$(".carouselDot").unbind();$(".carouselDot").click(function(){var dot=$(this);var imageWrapper=dot.parent().parent().find(".carouselImageWrapper");var index=dot.prevAll().length;carouselAnimateToPos(imageWrapper,index);clearInterval(imageWrapper.data("interval"))})}function carouselReset(){var imageWrappers=$(".block-carousel .carouselImageWrapper");imageWrappers.each(function(){var wrapper=$(this);var tween=wrapper.data("tween");if(tween){tween.kill();wrapper.removeData("tween")}});TweenLite.set(imageWrappers,{x:0});carouselsInit()}function carouselsInit(){carouselDotsInit();var imageWrappers=$(".block-carousel .carouselImageWrapper");imageWrappers.each(function(){var wrapper=$(this);wrapper.data("imageCount",wrapper.find(".carouselImage").length);wrapper.data("pos",0)});imageWrappers.each(function(){var wrapper=$(this);var intervalTimeMs=wrapper.attr("data-interval")*1e3;var previousInterval=wrapper.data("intervalId");if(previousInterval){clearInterval(previousInterval)}var interval=setInterval(function(){var images=wrapper.find(".carouselImage");var nextImageIndex=wrapper.data("pos")+1;if(nextImageIndex==images.length){nextImageIndex=0}var nextImage=images.eq(nextImageIndex);if(imageIsLoaded(nextImage)){nextImage.css("display","inline");console.log("Image loaded - animating");carouselAnimateToPos(wrapper,wrapper.data("pos")+1)}else{console.log("Image not loaded - will try again soon")}},intervalTimeMs);wrapper.data("intervalId",interval)})}function imageIsLoaded(pImage){return pImage.data("loaded")}function carouselAnimateToPos(pImageWrapper,pPos){var dots=pImageWrapper.parent().find(".carouselDot");dots.removeClass("current");var width=pImageWrapper.width();var images=pImageWrapper.find(".carouselImage");var translation=pPos*-width;if(pPos==images.length){pImageWrapper.append(images.eq(0).clone(true,true));images=pImageWrapper.find(".carouselImage");dots.eq(0).addClass("current")}else{dots.eq(pPos).addClass("current")}var tween=TweenLite.to(pImageWrapper,1,{x:translation,onComplete:function(){var imageCount=pImageWrapper.data("imageCount");if(images.length>imageCount){images.slice(imageCount).remove();TweenLite.set(pImageWrapper,{x:0});pImageWrapper.data("pos",0)}pImageWrapper.removeData("tween")}});pImageWrapper.data("pos",pPos);pImageWrapper.data("tween",tween)}function videosResize(){$(".block-vimeo, .block-youtube").find(".videoWrapper.crop").each(function(){var wrapper=$(this);var iframe=wrapper.find("iframe");wrapper.css("overflow","hidden");wrapper.css("position","relative");iframe.css("position","absolute");var elementWidth=wrapper.width();var elementHeight=wrapper.height();var videoWidth=elementWidth;var videoHeight=elementWidth*VIDEO_ASPECT_RATIO;if(videoHeight<elementHeight){videoHeight=elementHeight;videoWidth=videoHeight/VIDEO_ASPECT_RATIO}if(videoWidth>elementWidth){var left=-(videoWidth-elementWidth)/2;iframe.css("left",left);console.log("h adjust");console.log("width="+videoWidth)}else if(videoHeight>elementHeight){console.log("v adjust");console.log("height="+videoHeight)}iframe.width(videoWidth).height(videoHeight)})}