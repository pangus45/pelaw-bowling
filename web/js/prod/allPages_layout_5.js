var VIDEO_ASPECT_RATIO=.5625;var gPreviousScreenWidth=0;var gPreviousScreenHeight=0;var gPageSearches=0;var gSlideshowTimelines=[];var gElementJSData={};function responsiveBreaksInit(){if($("[data-responsive-break-below]").length==0){return}$("[data-responsive-break-below]").eachElement(function(pElement){pElement.hide();var value=pElement.data("responsive-break-below");var width=parseInt(value);if(isNaN(width)){return true}var mediaQuery=window.matchMedia("(max-width: "+width+"px)");if(mediaQuery.matches){}})}$(document).ready(function(){responsiveBreaksInit();jsDataInit();responsiveInit();videosInit();carouselsInit();slideshowInit();animatedGradientsInit();superCarouselBlocksInit();clickThroughsInit();facebookRefresh();twitterRefresh();togglesInit();$(window).resize(layoutResize);$(window).scroll(layoutScroll);pageHeightCalculate();loadEventsInit();articleListsInit();dateCountersInit()});function forEachBlock(pBlock,pCallback){$($(".block-"+pBlock)).each(function(pIndex){pCallback($(this))})}function dateCountersInit(){forEachBlock("dateCountdown",function(pBlock){var elementId=pBlock.attr("data-id");var data=gElementData[elementId]["dateCountdown"];setInterval(function(){dateCounterRefresh(pBlock,data)},1e3)})}function dateCounterRefresh(pBlock,pData){var day=pData.day;var month=pData.month-1;var hour=pData.hour;var year=pData.year;var now=new Date;var deadline=new Date(year,month,day,hour);if(deadline>now){var ms=deadline-now}else{var ms=0}ms=Math.max(0,ms);var delta=Math.abs(ms)/1e3;var days=Math.floor(delta/86400);delta-=days*86400;var hours=Math.floor(delta/3600)%24;delta-=hours*3600;var minutes=Math.floor(delta/60)%60;delta-=minutes*60;var seconds=delta%60;pBlock.find(".days").text(days);pBlock.find(".hours").text(hours);pBlock.find(".minutes").text(minutes);pBlock.find(".seconds").text(Math.round(seconds))}function currentLayoutGetAsString(){if(mobileLayout()){return"mobile"}else if(tabletLayout()){return"tablet"}else{return"desktop"}}function articleRowLinkInit(pRowWrapper){if(pRowWrapper.data("article-row-page-link")){pRowWrapper.click(function(){location.href=pRowWrapper.data("article-row-page-link")})}}function articleListsInit(){$(".pseudoRow").remove();$("[data-article-row]").each(function(){articleRowLinkInit($(this))});articleElementsInitialIndexSet();articleElementGroupsTag();articleListsUpdate()}function articleElementsInitialIndexSet(){$("[data-article-element-type]").each(function(){var element=$(this);var mobile=domClimbTo(element,".mobileLayout");if(mobile){var index=elementIndexInSelectorGet(element,$(".mobileSelectable"));element.data("initialElementIndex",index)}else{element.data("initialElementIndex",element.prevAll().length)}})}function articleElementGroupsTag(){$("[data-article-element-type]").each(function(pIndex){var element=$(this);if(element.data("grouped")){return true}var type=element.data("article-element-type");var index=element.data("article-index");var nextElement=nextArticleElementGet(element);var group=element;while(nextElement&&nextElement.data("article-index")==index&&nextElement.data("article-element-type")==type){group=group.add(nextElement);nextElement.data("grouped",true);nextElement=nextArticleElementGet(nextElement)}element.data("group",group)})}function elementIsInMobileLayout(pElement){return null!=domClimbTo(pElement,".mobileLayout")}function nextArticleElementGet(pArticleElement){if(!elementIsInMobileLayout(pArticleElement)){return pArticleElement.next()}var mobileLayoutWrapper=domClimbTo(pArticleElement,".mobileLayout");var articleElementSelector=mobileLayoutWrapper.find("[data-article-element-type]");var index=elementIndexInSelectorGet(pArticleElement,articleElementSelector);var nextIndex=index+1;if(nextIndex<articleElementSelector.length){return articleElementSelector.eq(nextIndex)}return null}function articleRowsUpdate(){currentLayoutSelectorGet().find("[data-article-row]").each(function(){articleRowUpdate($(this))})}function articleElementsUpdate(){currentLayoutSelectorGet().find("[data-article-element-type]").each(function(){articleElementUpdate($(this))})}function articleElementUpdate(pElement){if(pElement.data("grouped")){return}if(pElement.data("nextElementFetched")){return}var articleIndex=pElement.data("article-index");if(-1==articleIndex.indexOf("+")){return}var group=pElement;if(pElement.data("group")){group=pElement.data("group")}articleIndex=parseInt(articleIndex);var lastElement=group.eq(group.length-1);var template=lastElement;if(template.is("a")){template=lastElement.children().eq(0)}var elementTop=template.offset().top;var elementBottom=elementTop+template.outerHeight();var scrollTop=$(window).scrollTop();var screenBottom=$(window).height()+scrollTop;if(elementBottom<screenBottom+$(window).height()){var spinners=$();var firstElement=group.eq(0);firstElement.data("nextElementFetched",true);var lastElement=group.eq(group.length-1);var insertAfter=lastElement;var row=domClimbTo(firstElement,".mobileRowWrapper");if(row){var spacing=pElement.data("article-spacing");var spinner=articleListSpinnerCreate(row,row,spacing);spinners=spinners.add(spinner)}else{group.each(function(pIndex){var element=$(this);var template=element;if(!element.is(".mobileSelectable")){template=element.find(".mobileSelectable")}var spacing=0;if(pIndex==group.length-1){spacing=pElement.data("article-spacing")}var spinner=spinners.add(articleListSpinnerCreate(template,insertAfter,spacing));insertAfter=spinner;spinners=spinners.add(spinner)})}var pageArticleId=$("html").data("article-id");var pageArticleType=$("html").data("article-type");var data={elementScreen:currentLayoutGetAsString(),elementsStartIndex:group.eq(0).data("initialElementIndex"),elementsEndIndex:lastElement.data("initialElementIndex"),articleIndex:articleIndex+1,pageId:pageIdGet(),articleId:pageArticleId,articleType:pageArticleType};$.post("/articleElementsGet",data,function(pResponse){if(""==pResponse){spinners.remove()}else{var parser=new DOMParser;var dom=parser.parseFromString(pResponse,"text/html");var newElements=$(dom).find("[data-article-element-type]");var newColumns=null;if(row){spinners.remove();var clonedRow=row.clone();clonedRow.addClass("clonedRow");newColumns=clonedRow.find(".mobileHalfWidthColumn").empty();row.after(clonedRow)}newElements.each(function(pIndex){var newElement=$(this);var oldElement=group.eq(pIndex);var newElementAndChildren=newElement.find("*").addBack();var newElementSelectable=newElementAndChildren.filter(".mobileSelectable,.selectable");newElementSelectable.attr("id","");newElementSelectable.css("margin-top",0);newElement.data("article-index",articleIndex+1+"+");newElement.data("initialElementIndex",oldElement.data("initialElementIndex"));newElement.attr("style",oldElement.attr("style"));if(0!=pIndex){}else{}if(newElement.is(".mobileSelectable")){newElement.addClass("pseudoElement")}else{newElement.find(".mobileSelectable").addClass("pseudoElement")}newElement.addClass("pseudoElement");newElement.children().addClass("pseudoElement");if(newColumns){newColumns.eq(pIndex).append(newElement)}else{spinners.eq(pIndex).replaceWith(newElement)}if(newElement.find("[data-imageSrc]").length>0){newElement.css("opacity",0);allImagesLoadCheckAll()}else{TweenMax.to(newElement,.5,{opacity:1})}});articleElementGroupsTag();articleElementsUpdate()}})}}function allRootRowWrappersGet(){return currentLayoutSelectorGet().find(".rootRowWrapper").not(".pseudoRow")}function rowWrapperIndexGet(pRowWrapper){return elementIndexInSelectorGet(pRowWrapper,allRootRowWrappersGet())}function articleRowUpdate(pRowWrapper){if(pRowWrapper.hasClass("responsiveHidden")){l("Row hidden - ignoring "+pRowWrapper.attr("id"));return}if(pRowWrapper.hasClass("nextRowFetched")){return}var articleIndex=pRowWrapper.data("article-row-index");if("string"!=typeof articleIndex||-1==articleIndex.indexOf("+")){return}articleIndex=parseInt(articleIndex);if("column"==pRowWrapper.data("article-row-division")){var columns=pRowWrapper.find(".flexColumn").length;articleIndex+=columns}else{articleIndex+=1}var rowTop=pRowWrapper.offset().top;var rowBottom=rowTop+pRowWrapper.height();var scrollTop=$(window).scrollTop();var screenBottom=$(window).height()+scrollTop;if(rowBottom<screenBottom){pRowWrapper.addClass("nextRowFetched");var rowIndex=rowWrapperIndexGet(pRowWrapper);l("rowIndex",rowIndex);var data=pRowWrapper.data("initialRowIndex");if(def(pRowWrapper.data("initialRowIndex"))){rowIndex=pRowWrapper.data("initialRowIndex")}var data={rowScreen:currentLayoutGetAsString(),rowIndex:rowIndex,articleIndex:articleIndex,pageId:pageIdGet()};var pageArticleId=$("html").data("article-id");if(pageArticleId){data["articleId"]=pageArticleId}var spinnerWrapper=articleListSpinnerCreate(pRowWrapper,pRowWrapper,pRowWrapper.data("article-row-bottom-margin"));l("Fetching Article Row ",pRowWrapper.attr("id"));$.post("/articleRowsGet",data,function(pResponse){l("Article Row Fetched",pRowWrapper.attr("id"));if(""==pResponse){pRowWrapper.css("margin-bottom",spinnerWrapper.css("margin-bottom"));spinnerWrapper.remove()}else{var newRow=$(pResponse);newRow.attr("id","");newRow.data("article-row-index",articleIndex+"+");newRow.data("initialRowIndex",rowIndex);newRow.css("opacity",1);newRow.css("margin-top",0);newRow.addClass("pseudoRow");newRow.children(".rootRow").addClass("pseudoRow");newRow.find(".selectedElement").removeClass(".selectedElement");spinnerWrapper.replaceWith(newRow);articleRowLinkInit(newRow);allImagesLoadCheckAll();rowElementEffectsInit(newRow);articleRowsUpdate()}})}}function articleListSpinnerCreate(pTemplateElement,pInsertAfter,pSpacing){var height=pTemplateElement.outerHeight();if(0==height&&pTemplateElement.is("a")){height=pTemplateElement.children().eq(0).outerHeight()}var spinnerWrapper=$('<div style="text-align: center;" class="articleListSpinner">');var icon=$('<i class="fa fa-spinner fa-spin">').appendTo(spinnerWrapper);spinnerWrapper.css("height",height);spinnerWrapper.css("margin-bottom",pTemplateElement.css("margin-bottom"));pTemplateElement.css("margin-bottom",pSpacing);pInsertAfter.after(spinnerWrapper);var top=height/2-icon.height()/2;icon.css("top",height/2-icon.height()/2);return spinnerWrapper}function pageIdGet(){return $("html").attr("id")}function jsDataInit(){gBodyElementJSData=$.parseJSON(gBodyElementJSData);gMenuElementJSData=$.parseJSON(gMenuElementJSData);gFooterElementJSData=$.parseJSON(gFooterElementJSData);jsDataSectionAppend(gBodyElementJSData);jsDataSectionAppend(gMenuElementJSData);jsDataSectionAppend(gFooterElementJSData)}function jsDataSectionAppend(pSectionData){$.each(pSectionData,function(pElementID,pElementData){gElementJSData[pElementID]=pElementData})}function socialRefresh(pReplace){facebookRefresh(pReplace);twitterRefresh(pReplace)}function loadEventsInit(){$(".block-facebook").data("rowLoadEvent",function(){facebookRefresh(false)});$(".block-twitter").data("rowLoadEvent",twitterRefresh)}function videosInit(){videosResize()}function pageHeightCalculate(){if("auto"!=gPageHeight){return}if(!desktopLayout()){desktopPageHeightSet("auto");return}l("pageHeightCalculate");var lastRow=lastRootRowWrapperInDesktopMain();if("fixed"!=lastRow.css("position")){return}var scrollPos=0;gPageSearches=0;var scrollPos=pageHeightSearch(0,1e3);scrollPos=pageHeightSearch(scrollPos,500);scrollPos=pageHeightSearch(scrollPos,100);scrollPos=pageHeightSearch(scrollPos,10);scrollPos=pageHeightSearch(scrollPos,1);l("Found scroll pos in "+gPageSearches+" attempts");desktopPageHeightSet(scrollPos+$(window).height());rowScrollingUpdate()}function pageHeightSearch(pStartScrollPos,pIncrement){while(pStartScrollPos<1e4){gPageSearches++;if(lastRowIsInViewAtScrollPos(pStartScrollPos)){return pStartScrollPos-pIncrement}pStartScrollPos+=pIncrement}return pStartScrollPos-pIncrement}function lastRootRowWrapperInDesktopMain(){return $("#bodyInner .desktopLayout .rootRowWrapper").last()}function desktopPageHeightSet(pHeight){l("***Setting page height",pHeight);l($("#bodyInner .desktopLayout").css("height"));$("#bodyInner .desktopLayout").css("height",pHeight)}function desktopPageHeightGet(){return $("#bodyInner .desktopLayout").height()}function allRootRowWrappersSelectorGet(){return currentLayoutSelectorGet().find(".rootRowWrapper")}function lastRowIsInViewAtScrollPos(pScrollPos){$("html, body").css("scrollTop",pScrollPos);rowScrollingUpdate(pScrollPos);var screenHeight=$(window).height();var lastRow=lastRootRowWrapperInDesktopMain();var bottom=rowScreenBottomGet(lastRow);var footerHeight=$("#menuSlider footer").outerHeight();if(bottom<=screenHeight+footerHeight){return true}return false}function rowScreenBottomGet(pRowWrapper){if(pRowWrapper.css("position")=="fixed"){return parseFloat(pRowWrapper.css("top"))+translateYGet(pRowWrapper)+pRowWrapper.outerHeight(true)}else{l("To do - rowScreenBottomGet for non fixed element")}}function backgroundParallaxUpdate(){var scrollTop=$(window).scrollTop();var screenHeight=$(window).height();var screenBottom=scrollTop+screenHeight;currentLayoutSelectorGet().find("[data-background-parallax-velocity]").each(function(){var row=$(this);if(!row.data("initialBackgroundPositionY")){var y=row.css("background-position-y");if("undefined"==typeof y){y="0%"}row.data("initialBackgroundPositionY",y)}var rowTop=row.offset().top;var rowHeight=row.outerHeight();var rowBottom=rowTop+rowHeight;var initialY=row.data("initialBackgroundPositionY");if(rowTop<screenBottom){var velocity=row.data("background-parallax-velocity");var rowEntryPoint=rowTop-screenHeight;rowEntryPoint=Math.max(0,rowEntryPoint);var rowExitPoint=rowBottom;var scrollTopMax=$(document).height()-screenHeight;rowExitPoint=Math.min(scrollTopMax,rowExitPoint);var progressInPx=scrollTop-rowEntryPoint;var progressFraction=progressInPx/(rowExitPoint-rowEntryPoint);var backgroundSize=row.css("background-size");if(-1!=backgroundSize.indexOf("%")&&parseFloat(backgroundSize)<100){}if(velocity<0){var invertedFraction=1-progressFraction*-velocity;var backgroundY=Math.round(invertedFraction*100)}else{var backgroundY=Math.round(progressFraction*100*velocity)}var offset=backgroundPositionConvertToNumber(initialY);if(-1!=offset.indexOf("%")){backgroundY+=parseFloat(offset)}else{var percentage=parseFloat(offset)/rowHeight*100;backgroundY+=percentage}TweenLite.set(row,{backgroundPositionY:backgroundY+"%"})}})}function parallaxPauseCallbacksTrigger(pRowWrapper){pRowWrapper.find("*").each(function(){var element=$(this);if(element.data("parallaxPauseCallbacksTrigger")){element.data("parallaxPauseCallbacksTrigger")();element.removeData("parallaxPauseCallbacksTrigger")}})}function parallaxRowYTranslationGetFromScrollTop(pRowWrapper,pScrollTop){var screenHeight=$(window).height();var initialTop=pRowWrapper.data("row-top");if("string"!=typeof initialTop){initialTop=initialTop.toString()}var pauseAt=pRowWrapper.data("row-pause-at");var velocity=pRowWrapper.data("row-parallax-velocity");var scrollTopMax=$("#bodyInner").outerHeight()-screenHeight;var progressFraction=pScrollTop/scrollTopMax;var displacementInPx=progressFraction*velocity*scrollTopMax;if(-1!=initialTop.indexOf("vh")||-1!=initialTop.indexOf("%")){var startPosInPx=parseFloat(initialTop)*screenHeight/100}else{var startPosInPx=parseFloat(initialTop)}pRowWrapper.data("top",startPosInPx);pRowWrapper.data("transformY",displacementInPx);var actualScreenPosInPx=startPosInPx+displacementInPx;var pauseTriggered=false;if("undefined"!==typeof pauseAt){if(pauseAt.toString().indexOf("px")!=-1){var pauseAtInPx=parseFloat(pauseAt)}else{var pauseAtInPx=parseFloat(pauseAt)*screenHeight/100}var diff=actualScreenPosInPx-pauseAtInPx;if(velocity>0&&diff>0){displacementInPx=displacementInPx-diff;pauseTriggered=true}else if(velocity<0&&diff<0){displacementInPx=displacementInPx-diff;pauseTriggered=true}}return{pauseTriggered:pauseTriggered,yTranslation:displacementInPx}}var rows=null;function rowScrollingUpdate(pSimulatedScrollTop){backgroundParallaxUpdate();if(mobileLayout()){return}var scrollTop=$(window).scrollTop();if("undefined"!=typeof pSimulatedScrollTop){scrollTop=pSimulatedScrollTop}if(!rows){rows=$(".rootRowWrapper")}rows.data("paused",false);rows.each(function(){var first=false;var second=false;var rowWrapper=$(this);var pausePointTriggered=false;var pauseAt=rowWrapper.data("row-pause-at");if(domClimbTo(rowWrapper,".desktopLayout")){}if(rowWrapper.attr("id")==="mainDesktopRowWrapper0"){first=true}if(rowWrapper.attr("id")==="mainDesktopRowWrapper1"){second=true}if(rowWrapper.is("[data-attached-to-row]")){var attachedToRow=attachedRowWrapperGet(rowWrapper);if(attachedToRow){var newY=0;var pauseWithAttached=rowWrapper.data("row-pause-with-attached");if(attachedToRow.data("paused")&&"no"===pauseWithAttached){var height=0;var chainData=attachedRowChainDataGet(rowWrapper,height);if(second){l(chainData)}var topRowTop=0;if(rowIsParallax(chainData.topRow)){topRowTop=chainData.topRow.data("top")}else{topRowTop=elementTopRelativeToScreenGet(chainData.topRow,scrollTop)}newY=topRowTop+rowYTranslateGet(chainData.topRow)+chainData.totalHeight;if(second){l(1)}}else{var attachedToRowBottom=elementBottomRelativeToScreenGet(attachedToRow,scrollTop);if(second){}var translateY=rowYTranslateGet(attachedToRow);if(second){}var cumulativeAttachedToRowBottom=attachedToRowBottom+translateY;newY=cumulativeAttachedToRowBottom;if(attachedToRow.data("paused")){rowWrapper.data("paused",true)}if(second){}}if("undefined"!==typeof pauseAt){var screenHeight=$(window).height();var pauseAtInPx=0;if(pauseAt.toString().indexOf("px")!=-1){pauseAtInPx=parseFloat(pauseAt)}else{pauseAtInPx=parseFloat(pauseAt)*screenHeight/100}var diff=newY-pauseAtInPx;var topRowData=attachedRowChainDataGet(rowWrapper);var topRow=topRowData.topRow;var velocity=topRow.data("row-parallax-velocity");if("undefined"==typeof velocity){velocity=-1}if(velocity>0&&diff>0){pausePointTriggered=true}else if(velocity<0&&diff<0){pausePointTriggered=true}if(pausePointTriggered){newY=pauseAtInPx}}elementScreenYSetUsingTransform(rowWrapper,newY)}}else if(rowWrapper.is("[data-row-parallax-velocity]")){var data=parallaxRowYTranslationGetFromScrollTop(rowWrapper,scrollTop);pausePointTriggered=data.pauseTriggered;TweenLite.set(rowWrapper,{y:data.yTranslation});rowWrapper.data("yTranslate",data.yTranslation)}if(pausePointTriggered){rowWrapper.data("paused",true);parallaxPauseCallbacksTrigger(rowWrapper)}})}function rowYTranslateGet(pRow){if(pRow.data("yTranslate")){return pRow.data("yTranslate")}return translateYGet(pRow)}function elementScreenYSetUsingTransform(pElement,pScreenY){var yTransform=pScreenY-elementTopInPixelsGet(pElement);TweenLite.set(pElement,{y:yTransform,z:1});pElement.data("yTranslate",yTransform)}function elementTopInPixelsGet(pElement){var top=pElement.css("top");var topInPx=parseFloat(top);return topInPx}function elementTopRelativeToScreenGet(pElement,pSimulatedScrollTop,pIncludeMargin){if("fixed"==pElement.css("position")){return parseFloat(pElement.css("top"))+parseFloat(pElement.css("margin-top"))}var scrollTop=$(window).scrollTop();if("undefined"!=typeof pSimulatedScrollTop){scrollTop=pSimulatedScrollTop}var top=pElement.offset().top-scrollTop;if(pIncludeMargin){top-=parseFloat(pElement.css("margin-top"))}return top}function rowIsParallax(pRowWrapper){var velocity=pRowWrapper.data("row-parallax-velocity");return"fixed"==pRowWrapper.css("position")&&velocity&&0!=velocity}function elementBottomRelativeToScreenGet(pElement,pSimulatedScrollTop){return elementTopRelativeToScreenGet(pElement,pSimulatedScrollTop)+pElement.outerHeight()+parseFloat(pElement.css("margin-bottom"))}function attachedRowChainDataGet(pRowWrapper){var data=attachedRowChainDataGetRecursive(pRowWrapper);if(!data){return null}data.totalHeight=data.totalHeight-parseFloat(data.topRow.css("margin-top"));return data}function attachedRowChainDataGetRecursive(pRowWrapper,pHeight){if(!pHeight){pHeight=0}var attachedToRow=attachedRowWrapperGet(pRowWrapper);if(!attachedToRow){return null}pHeight+=attachedToRow.outerHeight(true);var attachedToAttachedToRow=attachedRowWrapperGet(attachedToRow);if(attachedToAttachedToRow){return attachedRowChainDataGetRecursive(attachedToRow,pHeight)}return{topRow:attachedToRow,totalHeight:pHeight}}function attachedRowWrapperGet(pRowWrapper){var attachedToRowName=pRowWrapper.data("attached-to-row");attachedToRowWrapper=$('[data-row-name="'+attachedToRowName+'"]');if(attachedToRowWrapper.length>0){return attachedToRowWrapper}return null}function backgroundPositionConvertToNumber(pPosition){if("center"==pPosition){return"50%"}else if("top"==pPosition){return"0%"}else if("bottom"==pPosition){return"100%"}return pPosition}function editorIsActive(){return typeof gEditorLoaded!=="undefined"}function togglesInit(){$("[class]").each(function(){var element=$(this);var classAttr=element.attr("class");if(!classAttr){return true}var classes=classAttr.split(" ");$.each(classes,function(pIndex,pClass){if(-1!=pClass.indexOf("toggle-")){var targetClass=pClass.substr(7);var targetElement=$("."+targetClass);if(targetElement.length>0){var elementAndDescendants=element.find("*");elementAndDescendants.addClass("clickable");if(!editorIsActive()){var url=location.href;var hide=true;if(-1!=url.indexOf("#")){var parts=url.split("#");var linkSelector="#"+parts[parts.length-1];if(targetClass==parts[parts.length-1]){hide=false}}if(hide){targetElement.hide()}}elementAndDescendants.click(function(){targetElement.css("opacity",1);targetElement.slideToggle();return false})}}})})}var gLastScrollTime=0;function layoutScroll(){gLastScrollTime=Date.now();rowScrollingUpdate();articleListsUpdate()}function articleListsUpdate(){articleRowsUpdate();articleElementsUpdate()}function timeSinceLastScrollMsGet(){return Date.now()-gLastScrollTime}function formFocus(pFocusWhenNotSubmittedDesktop,pFocusWhenNotSubmittedMobile){var successOrErrorMessage=currentLayoutSelectorGet().find(".successMessage,form .has-error");if(!editorLoaded()&&successOrErrorMessage.length){elementScrollToCentre(successOrErrorMessage.eq(0),true)}else{if(desktopLayout()){pFocusWhenNotSubmittedDesktop&&firstInputFocus()}else{pFocusWhenNotSubmittedMobile&&firstInputFocus()}}}function formFileFieldSizeConstraintInit(pForm){if(!browserSupportsFileAPI()){return}pForm.find("input[type=file]").change(function(){var input=$(this);var maxSize=input.data("max-file-size");if(maxSize){if("M"==maxSize.substr(maxSize.length-1)){var maxSizeInBytes=parseInt(maxSize)*1e6;var errorMessage="Sorry this file was too large. It should be less than "+maxSize+"B.";input.parent().find(".fileTooLargeMessage").remove();if(this.files[0].size>maxSizeInBytes){input.after('<div class="fileTooLargeMessage">'+errorMessage+"</div>");input.val("")}}}})}function firstInputFocus(){var clickableElements="input, select, button, textarea";currentLayoutSelectorGet().find(clickableElements).eq(0).focus()}function formSubmitted(){return currentLayoutSelectorGet().find(".successMessage").length}function clickThroughsInit(){$(".clickThrough").on("click touchstart",function(pEvent){var clickedElement=$(this);var elementBehind=inputBehindGet(pEvent,clickedElement);if(elementBehind){if(elementBehind.is("button,input[type=checkbox]")){var form=domClimbTo(elementBehind,"form");elementBehind.trigger(pEvent.type)}else{elementBehind.focus()}}});$(".clickThrough").mousemove(function(pEvent){var element=$(this);clickThroughCursorCheck(pEvent,element)})}function clickThroughCursorCheck(pEvent,pElement){var clickableElements="input, select, button, textarea, label";var inputBehind=inputBehindGet(pEvent,pElement);if(inputBehind.is(clickableElements)){if(inputBehind.is("button,input[type=checkbox]")){pElement.css("cursor","pointer");inputBehind.addClass("clickThroughHover");console.log(pElement.attr("class"))}else{pElement.css("cursor","text");$(".clickThroughHover").removeClass("clickThroughHover")}}else{pElement.css("cursor","default");$(".clickThroughHover").removeClass("clickThroughHover")}}function inputBehindGet(pEvent,pElement){console.log(pElement.attr("class"));var rowWrapper=domClimbTo(pElement,".rowWrapper");if(!rowWrapper){rowWrapper=pElement}rowWrapper.hide();if("touchstart"==pEvent.type){pEvent=pEvent.originalEvent.touches[0]}var elementBehind=$(document.elementFromPoint(pEvent.clientX,pEvent.clientY));rowWrapper.show();if(elementBehind.length==0){return null}return elementBehind}function animatedGradientsInit(){$("[data-animatedGradientColours]").each(function(){var element=$(this);var coloursAttribute=element.attr("data-animatedGradientColours");var colours=$.parseJSON(coloursAttribute);if(colours.length<4){return true}element.data("animatedGradientStep",0);element.data("animatedGradientIndices",[0,1,2,3]);if(element.data("interval")){clearInterval(interval)}var interval=setInterval(function(){updateGradient(element)},10);element.data("interval",interval)})}function updateGradient(pElement){var step=pElement.data("animatedGradientStep");var colourIndices=pElement.data("animatedGradientIndices");var coloursAttribute=pElement.attr("data-animatedGradientColours");var speedAttribute=pElement.attr("data-animatedGradientSpeed");var gradientSpeed=parseFloat(speedAttribute)/1e3;var hexColours=$.parseJSON(coloursAttribute);var rgbaColours=[];$.each(hexColours,function(pIndex,pColour){var rgbColour=hexToRgb(pColour);rgbaColours.push(rgbColour)});if(!colourIndices){return}var c0_0=rgbaColours[colourIndices[0]];var c0_1=rgbaColours[colourIndices[1]];var c1_0=rgbaColours[colourIndices[2]];var c1_1=rgbaColours[colourIndices[3]];var istep=1-step;var r1=Math.round(istep*c0_0[0]+step*c0_1[0]);var g1=Math.round(istep*c0_0[1]+step*c0_1[1]);var b1=Math.round(istep*c0_0[2]+step*c0_1[2]);var color1="rgb("+r1+","+g1+","+b1+")";var r2=Math.round(istep*c1_0[0]+step*c1_1[0]);var g2=Math.round(istep*c1_0[1]+step*c1_1[1]);var b2=Math.round(istep*c1_0[2]+step*c1_1[2]);var color2="rgb("+r2+","+g2+","+b2+")";pElement.css({background:"-webkit-gradient(linear, left top, right top, from("+color1+"), to("+color2+"))"}).css({background:"-moz-linear-gradient(left, "+color1+" 0%, "+color2+" 100%)"}).css({background:"linear-gradient(to right, "+color1+" 0%, "+color2+" 100%)"});step+=gradientSpeed;if(step>=1){step%=1;colourIndices[0]=colourIndices[1];colourIndices[2]=colourIndices[3];colourIndices[1]=(colourIndices[1]+Math.floor(1+Math.random()*(rgbaColours.length-1)))%rgbaColours.length;colourIndices[3]=(colourIndices[3]+Math.floor(1+Math.random()*(rgbaColours.length-1)))%rgbaColours.length}pElement.data("animatedGradientStep",step);pElement.data("animatedGradientIndices",colourIndices)}function flexSet(pElement,pFlexValue){pElement.css("flex",pFlexValue);pElement.css("-webkit-box-flex",pFlexValue);pElement.css("-moz-box-flex",pFlexValue);pElement.css("-webkit-flex",pFlexValue);pElement.css("-ms-flex",pFlexValue)}function layoutResize(){l("Layout Resize");if($(window).width()==gPreviousScreenWidth&&$(window).height()==gPreviousScreenHeight){return}gPreviousScreenWidth=$(window).width();gPreviousScreenHeight=$(window).height();responsiveBreaksInit();responsiveRefresh();videosResize();facebookRefresh(true);twitterRefresh(true);superCarouselsResize();carouselReset();pageHeightCalculate();rolloversRefreshIfPresent();articleListsUpdate();setTimeout(function(){twitterRefresh(true);allImagesLoadCheckAll()},0)}function rolloversRefreshIfPresent(){if(typeof rolloversRefresh!=="undefined"){rolloversRefresh()}}function responsiveInit(){$(".flexRow").each(function(){var row=$(this);var firstColumn=row.find(".flexColumn");var margin=firstColumn.css("margin-right");row.data("originalMargin",firstColumn.css("margin-right"))});responsiveRefresh()}function responsiveHidePartsGet(pElement){if(pElement.data("hideParts")){return pElement.data("hideParts")}var part=htmlDecode(pElement.attr("data-hide"));var hideParts=part.split(",");pElement.data("hideParts",hideParts);return hideParts}function responsiveRefresh(){l("responsiveRefresh");$("[data-hide]").each(function(){var element=$(this);var screenWidth=$(window).width();var hideParts=responsiveHidePartsGet(element);elementShowResponsive(element);$.each(hideParts,function(pIndex,pPart){pPart=pPart.trim();if("<="==pPart.substr(0,2)){var number=pPart.substr(2);if(screenWidth<=number){elementHideResponsive(element)}else{}}else if("<"==pPart.substr(0,1)){var number=pPart.substr(1);if(screenWidth<number){elementHideResponsive(element)}else{}}else if(">="==pPart.substr(0,2)){var number=pPart.substr(2);if(screenWidth>=number){elementHideResponsive(element)}else{}}else if(">"==pPart.substr(0,1)){var number=pPart.substr(1);if(screenWidth>number){elementHideResponsive(element)}else{}}})});rowMarginsRefresh()}function elementShowResponsive(pElement){if(!pElement.hasClass("responsiveHidden")){return}pElement.removeClass("responsiveHidden");originalDisplayStore(pElement);var display=pElement.data("originalDisplay");pElement.css("display",display);pElement.find(".layoutSquare").data("responsiveHidden",false);if(pElement.is(".flexColumn")){var rowWrapper=domClimbTo(pElement,".rowWrapper");rowWrapper.removeData("FADE_STATE")}}function originalDisplayStore(pElement){var originalDisplay=pElement.data("originalDisplay");if(!originalDisplay){pElement.data("originalDisplay",pElement.css("display"))}}function elementHideResponsive(pElement){if(pElement.hasClass("responsiveHidden")){return}pElement.addClass("responsiveHidden");originalDisplayStore(pElement);pElement.css("display","none");pElement.data("responsiveHidden",true);pElement.find(".layoutSquare").data("responsiveHidden",true)}function rowMarginsRefresh(){$(".flexRow").each(function(){var row=$(this);var columns=row.children();if(columns.length<=1){return true}columns.each(function(pIndex,pColumn){var column=$(this);var margin=row.data("originalMargin");if(0==pIndex){column.css("margin-right",margin)}else if(columns.length-1==pIndex){column.css("margin-left",margin)}else{column.css("margin-left",margin);column.css("margin-right",margin)}})})}function currentLayoutSelectorGet(){var layoutRoot=$("#bodyInner");if("footer-edit"==gPageId){layoutRoot=$("footer")}else if("menu-edit"==gPageId){layoutRoot=$("#menuLayout")}return layoutRoot.find(layoutSelectorClassSelectorStringGet())}function footerLayoutSelectorGet(){return $("footer").find(layoutSelectorClassSelectorStringGet())}function menuLayoutSelectorGet(){return $("#menuLayout").find(layoutSelectorClassSelectorStringGet())}function layoutSelectorClassSelectorStringGet(){if(mobileLayout()){return".mobileLayout"}else if(tabletLayout()){return".tabletLayout"}return".desktopLayout"}function layoutGetAsString(){if(mobileLayout()){return"mobile"}else if(tabletLayout()){return"tablet"}return"desktop"}function mobileLayout(){return"right"==$("#layoutMediaQuery").css("float")}function desktopLayout(){return"left"==$("#layoutMediaQuery").css("float")}function tabletLayout(){return"none"==$("#layoutMediaQuery").css("float")}function slideshowInit(){if(browserIsIE()){}$.each(gSlideshowTimelines,function(pIndex,pTimeline){pTimeline.kill()});gSlideshowTimelines=[];setTimeout(function(){$(".block-slideshow").each(function(){var block=$(this);nextSlideshowImageAnimateRecursive(block,block.find(".slideShowImage").last(),true)})},3e3)}function slideShowImageChangeCallbackRegister(pBlock,pCallback){pBlock.data("slideShowImageChangeCallback",pCallback)}function nextSlideshowImageAnimateRecursive(pBlock,pImage,pFirst){var elementId=pBlock.attr("data-id");var data=gElementData[elementId];var interval=data.interval;var scaleLower=data.slideshowScaleLower;var scaleUpper=data.slideshowScaleUpper;var diff=scaleUpper-scaleLower;var scaleMiddle=scaleLower+diff/3;var timeline=new TimelineLite;gSlideshowTimelines.push(timeline);var callback=function(){var prevImage=pImage.prev();if(pBlock.data("slideShowImageChangeCallback")){pBlock.data("slideShowImageChangeCallback")(prevImage)}if(!prevImage.is("script")){prevImage.css("opacity",1);nextSlideshowImageAnimateRecursive(pBlock,prevImage,false)}};if(pFirst){if(browserIsIE()){timeline.to(pImage,interval*.9,{onComplete:callback})}else{timeline.to(pImage,interval*.9,{scale:scaleUpper,rotation:.01,onComplete:callback,ease:Power0.easeNone})}}else{if(browserIsIE()){timeline.to(pImage,interval*.9,{onComplete:callback})}else{timeline.to(pImage,interval*.1,{scale:scaleMiddle,rotation:.01,ease:Power0.easeNone});timeline.to(pImage,interval*.8,{scale:scaleUpper,rotation:.01,ease:Power0.easeNone,onComplete:callback})}}var opacityTransition=.1;if(browserIsIE()){opacityTransition=.5}timeline.to(pImage,interval*opacityTransition,{opacity:0,onComplete:function(){pBlock.find("script").after(pImage);TweenLite.set(pImage,{scale:scaleLower,rotation:.01})}})}function twitterRefresh(pReplace){var twitterBlocks=currentLayoutSelectorGet().find(".block-twitter");twitterBlocks.each(function(){var block=$(this);if(!pReplace&&block.find("iframe").length>0){return}var data=elementDataGet(block);if(!data.user){return}var borderContainer=block.find(".blockBorderContainer");if("fit"==data.height){var height=block.height()-borderContainer.outerHeight();var html='<a data-height="'+height+'" class="twitter-timeline" href="https://twitter.com/'+data.user+'"></a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>'}else if(-1!=data.height.indexOf("t")){var html='<a data-tweet-limit="'+parseInt(data.height)+'" class="twitter-timeline" href="https://twitter.com/'+data.user+'"></a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>'}else if(""!=data.height&&0!=data.height){var html='<a data-height="'+data.height+'" class="twitter-timeline" href="https://twitter.com/'+data.user+'"></a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>'}else{var html='<a data-tweet-limit="6" class="twitter-timeline" href="https://twitter.com/'+data.user+'"></a> <script async src="//platform.twitter.com/widgets.js" charset="utf-8"><\/script>'}borderContainer.empty();borderContainer.html(html)})}function elementDataGet(pElement){var elementId=pElement.attr("data-id");if(elementId in gElementData){return gElementData[elementId]}return null}function facebookRefresh(pReplace){var facebookBlocks=currentLayoutSelectorGet().find(".block-facebook");facebookBlocks.each(function(){var block=$(this);if(!pReplace&&block.find("iframe").length>0){return}var column=domClimbTo(block,".flexColumn");var data=elementDataGet(block);if(!data){return}var urlEnd=data.url;if(""==urlEnd){return}block.empty();var width=parseInt(block.innerWidth());width=Math.min(width,500);var height=500;if(column){var heightPercentage=parseFloat(data.height);if(!isNaN(heightPercentage)){height=column.height()*heightPercentage/100}}height=parseInt(height);var baseUrl="https://www.facebook.com/plugins/page.php";var params="href=https%3A%2F%2Fwww.facebook.com%2F"+urlEnd+"&width="+width+"&height="+height+"&tabs=timeline&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId=390487257738943";var widthAttr='width="'+width+'" ';var heightAttr='height="'+height+'" ';var attr=widthAttr+heightAttr+'style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"';var iframe=$('<iframe src="'+baseUrl+"?"+params+'" '+attr+"></iframe>");block.append(iframe);iframe.data("currentWidth",width);iframe.data("currentHeight",height)})}function videosResize(){l("videoResizeStart",$(window).width());$(".block-vimeo, .block-youtube").find(".videoWrapper.crop").each(function(){var wrapper=$(this);var iframe=wrapper.find("iframe");wrapper.css("overflow","hidden");wrapper.css("position","relative");iframe.css("position","absolute");var elementWidth=wrapper.width();var elementHeight=wrapper.height();var videoWidth=elementWidth;var videoHeight=elementWidth*VIDEO_ASPECT_RATIO;if(videoHeight<elementHeight){videoHeight=elementHeight;videoWidth=videoHeight/VIDEO_ASPECT_RATIO}if(videoWidth>elementWidth){var left=-(videoWidth-elementWidth)/2;iframe.css("left",left);console.log("h adjust");console.log("width="+videoWidth)}else if(videoHeight>elementHeight){console.log("v adjust");console.log("height="+videoHeight);iframe.css("left",0)}iframe.width(videoWidth).height(videoHeight)});l("videoResizeEnd",$(window).width())}function elementGetFromId(pId){var element=$("[data-id="+pId+"]");if(element.length>0){return element}return null}function deviceisDesktop(){return $("html").is(".desktop")}function elementIsInDesktopLayout(pElement){return null!=domClimbTo(pElement,".desktopLayout")}