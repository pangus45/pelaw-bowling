gRowLoadedCallbacks=[];$(document).ready(function(){l("Image loader ready");allImagesLoadCheck(true);$(".mobileSelectable").each(function(){mobileAnimsInit($(this))});firstRowInit()});function firstRowInit(){var rows=rowWrapperSelectorGet();if(0==rows.length){return}var firstRow=rows.eq(0);firstRowStaggeredImageLoadCheck();var faded=firstRow.attr("data-fadedIn");if(!faded){l("Still waiting for first row to fade in - registering callback");gFirstRowFadeCallbacks.push(firstRowFadedCallback)}else{l("First row already faded - executing callback immediately");firstRowFadedCallback()}}function firstRowFadedCallback(){var rows=rowWrapperSelectorGet();var firstRow=rows.eq(0);rowFadedCallback(firstRow)}function allImagesLoadCheckAll(pAllImagesLoadedCallback){allImagesLoadCheck(false,pAllImagesLoadedCallback)}function editorLoaded(){return typeof gEditorLoaded!=="undefined"}function allImagesLoadCheck(pOmitFirst,pAllImagesLoadedCallback){if(editorLoaded()){$(".rootRowWrapper").each(function(){var wrapper=$(this);if(0==wrapper.css("opacity")&&!wrapper.hasClass("ignoreFade")){wrapper.css("opacity",1)}rowAnimsInit(wrapper)});if(!mobileLayout()){var interval=null;imagesLoadCheck(rowWrapperSelectorGet(),false,function(){if(allImagesAreLoaded(rowWrapperSelectorGet())){if(interval){clearInterval(interval)}if("undefined"!=typeof rolloversRefresh){interval=setTimeout(rolloversRefresh,1e3)}pAllImagesLoadedCallback&&pAllImagesLoadedCallback()}})}else{imagesLoadCheck($(".mobileLayout"),false,function(){if(allImagesAreLoaded(menuLayoutSelectorGet())){pAllImagesLoadedCallback&&pAllImagesLoadedCallback()}});firstMobileElementFadeIn()}}else{if(!mobileLayout()){nextRowLoad(pOmitFirst)}else{var mobileImages=$(".mobileLayout").find("[data-imageSrc]");mobileStaggeredImageLoadCheck();if(pOmitFirst){mobileImages=$(".mobileSelectable").slice(1).find("[data-imageSrc]")}else{firstMobileElementFadeIn()}if(0==mobileImages.length){return}mobileImages.each(function(){var image=$(this);if(!image.data("loaded")){image.css("opacity",0)}});imagesLoadCheck(mobileImages,false,function(pLoadedElement){if(!pLoadedElement){return}var parent=domClimbTo(pLoadedElement,".mobileSelectable");if(parent&&0==parent.css("opacity")){l("Fading in element parent");pLoadedElement.css("opacity",1);if(!parent.hasClass("opacityZeroRemove")){TweenLite.to(parent,.5,{opacity:1})}}else{l("*** Fading in image ***");TweenLite.to(pLoadedElement,.5,{opacity:1})}})}}}function firstMobileElementFadeIn(){var firstElement=$("#mobileElement0");if(firstElement.length>0){if(firstElement.find("data-imageSrc").length==0){TweenLite.to(firstElement,.5,{opacity:1})}}}function unattachedImagesLoad(){}function rowWrapperSelectorGet(pOmitFirst){var selector=currentLayoutSelectorGet().find(".rowWrapper");if(pOmitFirst){selector=selector.slice(1)}var rows=selector.toArray();rows=rows.concat(menuLayoutSelectorGet().find(".rowWrapper").toArray());rows=rows.concat(footerLayoutSelectorGet().find(".rowWrapper").toArray());return $(rows)}var allRowWrappers=null;function nextRowLoad(pOmitFirst){var rowWrappers=rowWrapperSelectorGet(pOmitFirst);var wrappersInViewPort=[];var wrappersOutOfViewPort=[];$.each(rowWrappers,function(pIndex,pElement){var wrapper=$(this);if(elementIsInViewport(wrapper)){wrappersInViewPort.push(pElement)}else{wrappersOutOfViewPort.push(pElement)}});var orderedRowWrappers=wrappersInViewPort.concat(wrappersOutOfViewPort);$.each(orderedRowWrappers,function(pIndex,pRow){var row=$(pRow);if(row.data("loading")){return false}if("fadedIn"==row.data("FADE_STATE")||"fadingIn"==row.data("FADE_STATE")){return true}if(elementIsHidden(row)){return true}rowLoadEventsTrigger(row);if(rowHasNoImages(row)){if(elementIsInViewport(row)){rowFadeIn(row,function(){nextRowLoad(pOmitFirst)})}else{rowFadeIn(row);nextRowLoad(pOmitFirst)}return false}row.data("loading",true);imagesLoadCheck(row,false,function(){if(allImagesAreLoaded(row)){rowFadeCheck(row,pOmitFirst)}});return false})}function rowFadeCheck(pRow,pOmitFirst){if(elementIsInViewport(pRow)){rowFadeIn(pRow);setTimeout(function(){pRow.data("loading",false);nextRowLoad(pOmitFirst)},100)}else{rowFadeIn(pRow);pRow.data("loading",false);nextRowLoad(pOmitFirst)}}function rowLoadEventsTrigger(pRowWrapper){rowLoadedCallbacksExecute();var elements=pRowWrapper.find(".block");if(elements.length>0){elements.each(function(){var element=$(this);if(element.data("rowLoadEvent")){element.data("rowLoadEvent")();element.removeData()}})}}function rowHasNoImages(pRowWrapper){var columns=pRowWrapper.find(".flexColumn");var visibleColumns=columns.filter(function(){return!elementIsHidden($(this))});var clonedWrapper=pRowWrapper.clone();clonedWrapper.remove(".flexColumn");var wrapperPlusColumns=clonedWrapper.add(visibleColumns);return imagesSelectorGet(wrapperPlusColumns).length==0}function rowFadedCallback(pRowWrapper){if("undefined"!=typeof overlaysAddToRow){overlaysAddToRow(pRowWrapper)}rowAnimsInit(pRowWrapper);rowScrollingUpdate()}function lastRowLoadedCallback(){l("lastRowLoadedCallback");pageHeightCalculate()}function allRowsAreLoaded(){var rows=allRootRowWrappersSelectorGet().slice(1);var allRowsLoaded=true;$.each(rows,function(){var row=$(this);if(!rowIsLoaded(row)){allRowsLoaded=false}else{}});return allRowsLoaded}function rowIsLoaded(pRow){return"fadingIn"===pRow.data("FADE_STATE")||"fadedIn"===pRow.data("FADE_STATE")}function rowFadeIn(pRowWrapper,pCallback){pRowWrapper.data("FADE_STATE","fadingIn");if(allRowsAreLoaded()){lastRowLoadedCallback()}var fadeTime=.5;if(pRowWrapper.hasClass("noFade")){fadeTime=0}var timeline=new TimelineLite({onComplete:function(){pRowWrapper.data("FADE_STATE","fadedIn");rowFadedCallback(pRowWrapper);pCallback&&pCallback()}});if(pRowWrapper.hasClass("ignoreFade")){pRowWrapper.data("FADE_STATE","fadedIn");rowFadedCallback(pRowWrapper);pCallback&&pCallback();return}timeline.to(pRowWrapper,fadeTime,{opacity:1})}function srcGet(pImage){var imageSrc=pImage.attr("src");if(!imageSrc){imageSrc=pImage.css("background-image")}return imageSrc}function allImagesAreLoaded(pSelector){var allLoaded=true;var imageCount=0;imagesSelectorGet(pSelector).each(function(){var element=$(this);var loaded=element.data("loaded");var hidden=elementIsHidden(element);var ignore=element.data("loader-ignore");if("ignore"!=element.data("loader-ignore")&&!elementIsHidden(element)&&!element.data("loaded")){allLoaded=false}else{imageCount++}});if(allLoaded){}else{}return allLoaded}function imagesSelectorGet(pContainers){var selector=pContainers.find("[data-imageSrc]");pContainers.each(function(){var container=$(this);if(container.is("[data-imageSrc]")){selector=selector.add(container)}});return selector}function imagesLoadCheck(pSelector,pCheckViewPort,pImageLoadedCallback){if(allImagesAreLoaded(pSelector)){pImageLoadedCallback&&pImageLoadedCallback();return}var selector=imagesSelectorGet(pSelector);selector.each(function(){var element=$(this);if(element.data("loaded")){return}if(elementIsHidden(element)){l("Element is hidden");return}if(pCheckViewPort&&!elementIsInViewport(element)){return}imageLoad(element,"data-imageSrc",pImageLoadedCallback)})}function imageLoadCallbackRegister(pImageElement,pCallback){var imageData=earlyLoadImageDataGetFromId(pImageElement.attr("id"));if(imageData){if(imageData.loaded){pCallback()}else{imageData.callbacks.push(function(){pCallback()})}}else{if(pImageElement.data("loaded")){pCallback()}else{pImageElement.data("imageLoadedCallback",pCallback)}}}function rowLoadedCallbackRegister(pCallback){gRowLoadedCallbacks.push(pCallback)}function rowLoadedCallbacksExecute(){$.each(gRowLoadedCallbacks,function(pIndex,pCallback){pCallback()})}function imageLoadedCallbackTrigger(pImageElement){if(pImageElement.data("imageLoadedCallback")){pImageElement.data("imageLoadedCallback")(pImageElement);pImageElement.removeData("imageLoadedCallback")}}function imageLoaded(pImageElement,pImageLoadedCallback){pImageElement.data("loaded",true);pImageLoadedCallback&&pImageLoadedCallback(pImageElement);imageLoadedCallbackTrigger(pImageElement);staggeredImageLoadCheck(pImageElement)}function imageIsLoaded(pImage){return pImage.data("loaded")}function imageLoad(pImageElement,pDataAttribute,pImageLoadedCallback){var url=pImageElement.attr(pDataAttribute);if(pImageElement.is("img")){if(-1!=url.indexOf("data:image/jpeg;base64")){pImageElement.data("loaded",true);pImageElement.css("padding-bottom",0);l("image is not url but actual data - temp fix to ignore");imageLoaded(pImageElement,pImageLoadedCallback);return}l("Loading Image: "+url);l("Already loaded",pImageElement.data("loaded"));pImageElement.on("load",function(){if(pImageElement.data("loaded")){l("alreadyLoaded");return}pImageElement.css("padding-bottom",0);imageLoaded(pImageElement,pImageLoadedCallback)});pImageElement.attr("src",url)}else{l("Loading background image: "+url);var dummyImage=$('<img src="'+url+'" >');dummyImage.on("load",function(){if(pImageElement.data("loaded")){pImageLoadedCallback&&pImageLoadedCallback();return}pImageElement.css("background-image","url("+url+")");l("Background Image Loaded: "+url);imageLoaded(pImageElement,pImageLoadedCallback)})}}function mobileStaggeredImageLoadCheck(){var staggeredImages=$(".mobileLayout").find("[data-image-src-staggered]");if(staggeredImages.length>0){staggeredImageLoadCheck(staggeredImages.eq(0))}}function firstRowStaggeredImageLoadCheck(){var rows=rowWrapperSelectorGet();var firstRow=rows.eq(0);var staggeredImages=firstRow.find("[data-image-src-staggered]");if(staggeredImages.length>0){staggeredImageLoadCheck(staggeredImages.eq(0))}}function staggeredImageLoadCheck(pTriggerImage){var elementRoot=domClimbTo(pTriggerImage,".selectable,.mobileSelectable");if(!elementRoot){elementRoot=pTriggerImage}var staggeredImages=elementRoot.find("[data-image-src-staggered]");if(0==staggeredImages.length){return}if(staggeredImages.get(0).hasAttribute("data-staggered-reverse")){staggeredImages=staggeredImages.reverse()}staggeredImages.each(function(pImage){var staggeredImage=$(this);if(!staggeredImage.data("loaded")){var delay=staggeredImage.attr("data-image-load-delay");delay=delay?delay:0;l("Loading staggered image in "+delay*1e3);setTimeout(function(){l("Loading Staggered Image "+staggeredImage.data("image-src-staggered"));imageLoad(staggeredImage,"data-image-src-staggered")},delay*1e3);return false}})}