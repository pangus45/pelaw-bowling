$(document).ready(function(){console.log("Image loader ready");allImagesLoadCheck(true);$(window).scroll(allImagesLoadCheckAll);$(window).resize(allImagesLoadCheckAll)});function allImagesLoadCheckAll(){allImagesLoadCheck(false)}function imageLoaderResizeRefresh(){}function allImagesLoadCheck(pOmitFirst){if(typeof gEditorLoaded!=="undefined"){$(".rootRowWrapper").each(function(){var wrapper=$(this);if(0==wrapper.css("opacity")){wrapper.css("opacity",1)}});if(desktopLayout()){var interval=null;imagesLoadCheck($(".desktopLayout"),false,function(){if(allImagesAreLoaded($(".desktopLayout"))){if(interval){clearInterval(interval)}interval=setTimeout(rolloversRefresh,1e3)}editorResizeRefresh()})}else{imagesLoadCheck($(".mobileLayout"),false,function(){editorResizeRefresh()})}}else{if(desktopLayout()){nextRowLoad(pOmitFirst,true);firstRowStaggeredImageLoadCheck()}else{var mobileImages=$(".mobileLayout").find("[data-imageSrc]");if(pOmitFirst){mobileImages=$(".mobileSelectable").slice(1).find("[data-imageSrc]")}else{var firstElement=$(".mobileSelectable").eq(0);if(firstElement.length>0){if(firstElement.find("data-imageSrc").length==0){TweenLite.to(firstElement,1,{opacity:1})}}}mobileImages.each(function(){var image=$(this);if(!image.data("loaded")){image.css("opacity",0)}});imagesLoadCheck(mobileImages,false,function(pLoadedElement){var parent=domClimbTo(pLoadedElement,".mobileSelectable");if(parent&&0==parent.css("opacity")){pLoadedElement.css("opacity",1);TweenLite.to(parent,1,{opacity:1})}else{TweenLite.to(pLoadedElement,1,{opacity:1})}});mobileStaggeredImageLoadCheck()}}}function unattachedImagesLoad(){}function rowWrapperSelectorGet(pOmitFirst){var selector=$(".desktopLayout .rowWrapper, .desktopShow.imageLoadRow");if(mobileLayout()){selector=$(".mobileLayout .rowWrapper, .mobileShow.imageLoadRow")}if(pOmitFirst){return selector.slice(1)}return selector}function nextRowLoad(pOmitFirst){var allRowWrappers=rowWrapperSelectorGet(pOmitFirst);var elements=[];$.each(allRowWrappers,function(pIndex,pElement){var wrapper=$(this);if(elementIsInViewport(wrapper)){elements.push(pElement)}});$.each(allRowWrappers,function(pIndex,pElement){var wrapper=$(this);if(!elementIsInViewport(wrapper)){elements.push(pElement)}});$.each(elements,function(pIndex,pRow){var row=$(pRow);if(row.data("loading")){return false}if(elementIsHidden(row)){return true}if(rowHasNoImages(row)){if("fadedIn"==row.data("FADE_STATE")){return true}row.data("FADE_STATE","fadingIn");rowFadeIn(row,function(){row.data("FADE_STATE","fadedIn");nextRowLoad(pOmitFirst)});return false}if(allImagesAreLoaded(row)){return true}row.data("loading",true);var imageCount=0;imagesLoadCheck(row,false,function(){if(allImagesAreLoaded(row)){if(elementIsInViewport(row)){rowFadeIn(row);setTimeout(function(){row.data("loading",false);nextRowLoad(pOmitFirst)},100)}else{rowFadeIn(row);row.data("loading",false);nextRowLoad(pOmitFirst)}}});return false})}function rowHasNoImages(pRowWrapper){return imagesSelectorGet(pRowWrapper).length==0}function rowFadeIn(pRowWrapper,pCallback){var timeline=new TimelineLite({onComplete:function(){overlaysAddToRow(pRowWrapper);pCallback&&pCallback()}});var startTime=0;timeline.to(pRowWrapper,1,{opacity:1});var images=pRowWrapper.find("[data-imageSrc]");startTime+=.2;images.each(function(){var image=$(this);var fadeElement=domClimbTo(image,".layoutSquare,.block");if(!fadeElement){fadeElement=image}if(fadeElement.hasClass("noFade")){return}var targetOpacity=1;if(fadeElement.is(".rowLayer")){targetOpacity=fadeElement.css("opacity")}fadeElement.css("opacity",0);timeline.to(fadeElement,1,{opacity:targetOpacity},startTime);startTime+=.2})}function allImagesAreLoaded(pSelector){var allLoaded=true;imagesSelectorGet(pSelector).each(function(){var element=$(this);var hidden=elementIsHidden(element);if(!elementIsHidden(element)&&!element.data("loaded")){allLoaded=false}});return allLoaded}function imagesSelectorGet(pContainer){var selector=pContainer.find("[data-imageSrc]");if(pContainer.is("[data-imageSrc]")){selector=selector.add(pContainer)}return selector}function imagesLoadCheck(pSelector,pCheckViewPort,pImageLoadedCallback){var selector=imagesSelectorGet(pSelector);selector.each(function(){var element=$(this);if(element.data("loaded")){return}if(elementIsHidden(element)){console.log("Element is hidden");return}if(pCheckViewPort&&!elementIsInViewport(element)){return}imageLoad(element,"data-imageSrc",pImageLoadedCallback)})}function imageLoad(pImageElement,pDataAttribute,pImageLoadedCallback){var url=pImageElement.attr(pDataAttribute);if(pImageElement.is("img")){console.log("Loading Image: "+url);pImageElement.on("load",function(){if(pImageElement.data("loaded")){return}pImageElement.data("loaded",true);pImageElement.css("padding-bottom",0);pImageLoadedCallback&&pImageLoadedCallback(pImageElement);staggeredImageLoadCheck(pImageElement);console.log("Image Loaded: "+url)});pImageElement.attr("src",url)}else{console.log("Loading Background Image: "+url);var dummyImage=$('<img src="'+url+'" >');dummyImage.on("load",function(){if(pImageElement.data("loaded")){return}pImageElement.css("background-image","url("+url+")");pImageElement.data("loaded",true);pImageLoadedCallback&&pImageLoadedCallback(pImageElement);staggeredImageLoadCheck(pImageElement);console.log("Background Image Loaded"+url)})}}function mobileStaggeredImageLoadCheck(){var staggeredImages=$(".mobileLayout").find("[data-image-src-staggered]");if(staggeredImages.length>0){staggeredImageLoadCheck(staggeredImages.eq(0))}}function firstRowStaggeredImageLoadCheck(){var rows=rowWrapperSelectorGet();var firstRow=rows.eq(0);var staggeredImages=firstRow.find("[data-image-src-staggered]");if(staggeredImages.length>0){staggeredImageLoadCheck(staggeredImages.eq(0))}}function staggeredImageLoadCheck(pTriggerImage){var staggeredImages=pTriggerImage.parent().find("[data-image-src-staggered]");staggeredImages.each(function(pImage){var staggeredImage=$(this);if(!staggeredImage.data("loaded")){var delay=staggeredImage.attr("data-image-load-delay");delay=delay?delay:0;console.log("Loading staggered image in "+delay*1e3);setTimeout(function(){console.log("Loading Staggered Image "+staggeredImage.data("image-src-staggered"));imageLoad(staggeredImage,"data-image-src-staggered")},delay*1e3);return false}})}