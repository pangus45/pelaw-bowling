var gElementEffects={};var ADDITIONAL_PROPERTIES_MAP={rotationX:["transformOrigin"],rotationY:["transformOrigin"],rotationZ:["transformOrigin"]};var ADDITIONAL_EASE_PROPERTIES_MAP={wiggle:["wiggles","wiggleEase"]};$(document).ready(function(){l("Element effects init");allElementEffectsInit()});function rowElementEffectsInit(pRow){elementEffectsInitForContainer(pRow)}function allElementEffectsInit(){gElementEffects={};if("object"!=typeof gAnimTriggerPresets){gAnimTriggerPresets=$.parseJSON(gAnimTriggerPresets)}$.each(gElementJSData,function(pElementId,pData){if("elementEffects"in pData){gElementEffects[pElementId]=pData.elementEffects}});elementEffectsInitForContainer($("body"))}function elementEffectsInitForContainer(pContainer){$.each(gElementEffects,function(pID,pEffectData){var element=pContainer.find("[data-id="+pID+"]");if(element.data("initialized")){return true}element.data("initialized",true);elementEffectsPresetsProcess(pEffectData);elementEffectTriggersInit(element,pEffectData)})}function elementEffectsRefresh(){l("elementEffectTriggersRefresh");$.each(gElementEffects,function(pID,pEffectData){var element=$("[data-id="+pID+"]");if(element.data("initialized")){elementEffectTriggersRefresh(element,pEffectData);return true}else{l("Element effects not yet initialized")}})}function elementEffectTriggersRefresh(pAnimElement,pTriggers){$.each(pTriggers,function(pIndex,pTriggerData){var event=pTriggerData.properties.event;var triggerElements=triggerElementsGet(pAnimElement,pTriggerData);if(!triggerElements){l("Null trigger elements");return true}if(0==triggerElements.length){l("No trigger elements");return true}triggerElements.each(function(){var triggerElement=$(this);pTriggerData.element=triggerElement;if("inView"==event){elementEffectInViewCheck(pAnimElement,triggerElement,pTriggerData)}})})}function elementEffectsPresetsProcess(pEffects){$.each(pEffects,function(pIndex,pEffect){if("string"==typeof pEffect){if(pEffect in gAnimTriggerPresets){pEffects[pIndex]=JSON.parse(JSON.stringify(gAnimTriggerPresets[pEffect]))}else{pEffects.splice(pIndex,1);l("Anim preset not found - out of sync with other site version?")}}})}function hasElementOpacityEffect(pElement){var id=pElement.data("id");if(id in gElementEffects){var effects=gElementEffects[id];for(var i in effects){var effect=effects[i];if("element"==effect.element&&"opacity"==effect.property){return true}}}else{}return false}function elementEffectTriggersInit(pAnimElement,pTriggers){$.each(pTriggers,function(pIndex,pTriggerData){var event=pTriggerData.properties.event;var triggerElements=triggerElementsGet(pAnimElement,pTriggerData);if(!triggerElements){l("Null trigger elements");return true}if(0==triggerElements.length){l("No trigger elements");return true}triggerElements.each(function(){var triggerElement=$(this);pTriggerData.element=triggerElement;if("rollover"==event){rolloverElementEffectsInit(pAnimElement,pTriggerData)}if("load"==event){elementEffectsTimelinesCreate(pAnimElement,pTriggerData,false)}if("inView"==event){inViewElementEffectsInit(pAnimElement,triggerElement,pTriggerData)}if("click"==event){clickElementEffectsInit(pAnimElement,triggerElement,pTriggerData)}if("clickToggle"==event){clickToggleElementEffectsInit(pAnimElement,triggerElement,pTriggerData)}})})}function triggerElementsGet(pAnimElement,pTrigger){var element=pTrigger.properties.element;var part=pTrigger.properties.elementPart;var triggerElement=pAnimElement;if("elementAbove"==element){triggerElement=pAnimElement.prev()}else if("elementBelow"==element){triggerElement=pAnimElement.next()}else if("this"!=element){triggerElement=$("#"+element)}if("column"==part){var column=domClimbTo(triggerElement,".flexColumn");if(column){return column}}else if("row"==part){var rowWrapper=domClimbTo(triggerElement,".rowWrapper");if(rowWrapper){return rowWrapper}}else if("element"==part){return triggerElement}else if("image"==part){return triggerElement.find(".fluidHeightRowImage,.backgroundImage")}else if(0==part.indexOf("linksInText")){var index=part.substr("linksInText".length);return triggerElement.find(".textPart").eq(index).find("a")}else if(0==part.indexOf("text")){var index=part.substr("text".length);return triggerElement.find(".textPart").eq(index)}else if("multipleLinks"==part){return triggerElement.find("a")}return triggerElement}function clickElementEffectsInit(pElement,pTriggerElement,pTriggerData){var timelines=elementEffectsTimelinesCreate(pElement,pTriggerData,true,false);pTriggerElement.click(function(){timelines.main.restart(true);$.each(timelines.infinite,function(pIndex,pTimeline){pTimeline.restart(true)})})}function clickToggleOtherTimelinesInGroupReverse(pTriggerData,pElement){if("group"in pTriggerData.timelineProperties){var group=pTriggerData.timelineProperties.group;$.each(gElementEffects,function(pElementId,pTriggers){if(pElementId==pElement.data("id")){l("ignoring "+pElementId);return true}$.each(pTriggers,function(pIndex,pTrigger){if(!("group"in pTrigger.timelineProperties)){return true}if(group!=pTrigger.timelineProperties.group){return true}if("clickToggle"!=pTrigger.properties.event){return true}if(!("timelines"in pTrigger)){return true}$.each(pTrigger.timelines,function(pIndex,pTimelines){var element=elementGetFromId(pElementId);if(element.data("effectActive")){l(pElementId+" active")}else{l(pElementId+" inactive")}if(element.data("effectActive")){element.data("effectActive",false);l(pElementId+" reversed");pTimelines.main.reverse();$.each(pTimelines.infinite,function(pIndex,pTimeline){pTimeline.reverse()})}})})})}}function clickToggleElementEffectsInit(pAnimateElement,pTriggerElement,pTriggerData){var timelines=elementEffectsTimelinesCreate(pAnimateElement,pTriggerData,true,true);pAnimateElement.data("effectActive",false);pTriggerElement.click(function(){triggerElementClicked(pAnimateElement,timelines,pTriggerData)});if(pAnimateElement.hasClass("clickToggleOpen")){setTimeout(function(){triggerElementClicked(pAnimateElement,timelines,pTriggerData)},0)}}function triggerElementClicked(pAnimateElement,timelines,pTriggerData){var active=!pAnimateElement.data("effectActive");l("toggle clicked on "+pAnimateElement.data("id")+" "+active);pAnimateElement.data("effectActive",active);if(active){timelines.main.restart(true);$.each(timelines.infinite,function(pIndex,pTimeline){pTimeline.restart(true)});clickToggleOtherTimelinesInGroupReverse(pTriggerData,pAnimateElement)}else{timelines.main.reverse();$.each(timelines.infinite,function(pIndex,pTimeline){pTimeline.reverse()})}}function inViewElementEffectsInit(pAnimElement,pTriggerElement,pTrigger){elementEffectInViewCheck(pAnimElement,pTriggerElement,pTrigger);$(window).scroll(function(){elementEffectInViewCheck(pAnimElement,pTriggerElement,pTrigger)})}function elementEffectInViewCheck(pAnimElement,pTriggerElement,pTriggerData){if(elementIsInViewport(pTriggerElement)&&!pTriggerElement.data("elementEffectTriggered")){elementEffectsTimelinesCreate(pAnimElement,pTriggerData,false,false);pTriggerElement.data("elementEffectTriggered",true)}}function rolloverElementEffectsInit(pElement,pTriggerData){var timelines=elementEffectsTimelinesCreate(pElement,pTriggerData,true,true);pTriggerData.element.hover(function(){timelines.main.play();pElement.data("effectActive",true);$.each(timelines.infinite,function(pIndex,pTimeline){pTimeline.restart(true)})},function(){timelines.main.reverse();$.each(timelines.infinite,function(pIndex,pTimeline){pTimeline.reverse()})})}function additionalTweenPropertiesGet(pEffect,pProperty){var properties={};if(pProperty in ADDITIONAL_PROPERTIES_MAP){$.each(ADDITIONAL_PROPERTIES_MAP[pProperty],function(pIndex,pProperty){if(pProperty in pEffect){properties[pProperty]=pEffect[pProperty]}})}return properties}function setTextAddToTimeline(pTimeline,pElement,pEffect){pTimeline.add(function(){pElement.text(pEffect.setText)},pEffect.delay)}function addRemoveAddToTimeline(pTimeline,pElement,pEffect){var originalDisplay=pElement.css("display");pTimeline.add(function(){if("add"==pEffect.addRemove){pElement.css("display",originalDisplay)}else{pElement.css("display","none")}},pEffect.delay)}function swapTextAddToTimeline(pTimeline,pElement,pEffect){var rootElement=domClimbTo(pElement,".layoutSquare");if(-1==pEffect.swapText.indexOf("text")){return}if(!rootElement){return}var textIndex=pEffect.swapText.substr(4);var swapWithElement=rootElement.find(".textPart").eq(textIndex);var originalDisplayElement=pElement.css("display");var originalDisplaySwapWith=pElement.css("display");pTimeline.add(function(){if("none"==pElement.css("display")){pElement.css("display",originalDisplayElement);swapWithElement.css("display","none")}else{pElement.css("display","none");swapWithElement.css("display",originalDisplaySwapWith)}},pEffect.delay)}function animationsOrder(pAnims){pAnims.sort(function(pA,pB){if(""==pA.duration&&""!=pB.duration){return 1}if(""!=pA.duration&&""==pB.duration){return-1}return 0})}function inlineElementCheck(pProperty,pElement){if(-1!=pProperty.indexOf("scale")||-1!=pProperty.indexOf("rotation")||-1!=pProperty.indexOf("skew")||"x"==pProperty||"y"==pProperty||"z"==pProperty){if("inline"==pElement.css("display")){pElement.css("display","inline-block")}}}function elementEffectsTimelinesCreate(pElement,pTriggerData,pPaused,pRepeatControlled){var mainTimelineProperties={paused:pPaused,repeat:parseInt(pTriggerData.timelineProperties.repeat),delay:parseFloat(pTriggerData.timelineProperties.delay),repeatDelay:parseFloat(pTriggerData.timelineProperties.repeatDelay)};var mainTimeline=new TimelineMax(mainTimelineProperties);var infiniteTimelines=[];opacityCombineWithColourProperty(pElement,pTriggerData.effects);var lastFinish=0;animationsOrder(pTriggerData.effects);pTriggerData.timelines=[];$.each(pTriggerData.effects,function(pIndex,pEffect){var property=pEffect.property;var applyToElement=effectElementGetForProperty(pElement,property,pEffect.element,pTriggerData.element);if(applyToElement.length==0){l("Anim not found for element"+pElement.data("id"));return true}inlineElementCheck(property,applyToElement);if(0===pEffect.duration){pEffect.duration=.001}if(0===pEffect.delay){pEffect.delay=.001}if(""==pEffect.duration){pEffect.duration=mainTimeline.duration()-parseFloat(pEffect.delay)}if("setText"==pEffect.property){setTextAddToTimeline(mainTimeline,applyToElement,pEffect);return true}else if("addRemove"==pEffect.property){addRemoveAddToTimeline(mainTimeline,applyToElement,pEffect);return true}else if("swapText"==pEffect.property){swapTextAddToTimeline(mainTimeline,applyToElement,pEffect);return true}var tweenProperties=elementEffectPropertyAndValueProcessForTween(property,pEffect[property]);$.extend(tweenProperties,additionalTweenPropertiesGet(pEffect,property));if("z"==pEffect.property||"rotationY"==pEffect.property){TweenMax.set(applyToElement.parent(),{perspective:500})}if("opacity"==property&&pElement.hasClass("opacityZeroRemove")){pElement.removeClass("opacityZero");applyToElement.css("opacity",1)}if(isFilterProperty(property)){filterInitialValueSet(property,applyToElement);tweenProperties.autoRound=false}tweenProperties.ease=gEASES[pEffect.ease];var elementOuter=domClimbTo(applyToElement,".layoutSquare");if(elementOuter&&elementOuter.hasClass("overflowHidden")&&0==property.indexOf("scale")){tweenProperties.force3D=false}if(pEffect.delay===""){var delay=lastFinish}else{var delay=pEffect.delay}lastFinish+=parseFloat(pEffect.duration);if(-1==pEffect.repeat){var timelineProperties={yoyo:true,delay:pEffect.delay};if(pPaused){timelineProperties.paused=true}if(pRepeatControlled){timelineProperties.onComplete=function(){this.reverse()};timelineProperties.onReverseComplete=function(){if(pElement.data("effectActive")){this.play()}}}else{timelineProperties.repeat=-1}var timeline=new TimelineMax(timelineProperties);elementEffectTweenAddToTimeline(applyToElement,timeline,tweenProperties,pEffect,0);infiniteTimelines.push(timeline)}else{if(0!=pEffect.repeat){tweenProperties.repeat=parseInt(pEffect.repeat);tweenProperties.yoyo=true}elementEffectTweenAddToTimeline(applyToElement,mainTimeline,tweenProperties,pEffect,delay)}});pTriggerData.timelines.push({main:mainTimeline,infinite:infiniteTimelines});return{main:mainTimeline,infinite:infiniteTimelines}}var gBounceID=0;function squashBounceTweensAddToTimeline(pElement,pTimeline,pTweenProperties,pEffect,pDelay){var id="bounce"+gBounceID;CustomBounce.create(id,{squash:3,strength:.8});pTweenProperties.ease=id;var squashTweenProperties={scaleX:1.5,scaleY:.5,transformOrigin:"bottom",ease:id+"-squash"};if("from"==pEffect.fromTo){pTimeline.from(pElement,pEffect.duration,pTweenProperties,pDelay);pTimeline.to(pElement,pEffect.duration,squashTweenProperties,pDelay)}else{pTimeline.to(pElement,pEffect.duration,pTweenProperties,pDelay);pTimeline.to(pElement,pEffect.duration,squashTweenProperties,pDelay)}gBounceID++;return}function wiggleTweensAddToTimeline(pElement,pTimeline,pTweenProperties,pEffect,pDelay){var ease=CustomWiggle.create("wiggle",{wiggles:pEffect.wiggles,type:pEffect.wiggleEase});pTweenProperties.ease=ease;if("from"==pEffect.fromTo){pTimeline.from(pElement,pEffect.duration,pTweenProperties,pDelay)}else{pTimeline.to(pElement,pEffect.duration,pTweenProperties,pDelay)}return}function elementEffectTweenAddToTimeline(pElement,pTimeline,pTweenProperties,pEffect,pDelay){pEffect.duration=parseFloat(pEffect.duration);if("squashBounce"==pEffect.ease){squashBounceTweensAddToTimeline(pElement,pTimeline,pTweenProperties,pEffect,pDelay);return}else if("wiggle"==pEffect.ease){wiggleTweensAddToTimeline(pElement,pTimeline,pTweenProperties,pEffect,pDelay);return}if("to"==pEffect.fromTo){pTimeline.to(pElement,parseFloat(pEffect.duration),pTweenProperties,parseFloat(pDelay))}else{pTimeline.from(pElement,pEffect.duration,pTweenProperties,pDelay)}}function propertyEffectGetFromArray(pEffects,pProperty){for(var i in pEffects){var effect=pEffects[i];if(pProperty==effect.property){return effect}}return null}function opacityCombineWithColourProperty(pElement,pEffects){$.each(pEffects,function(pIndex,pEffect){if("colourOpacity"in pEffect){var colourValue=pEffect[pEffect.property];if(0==colourValue.indexOf("#")){var rgb=hexToRgb(colourValue);rgb.push(pEffect.colourOpacity);pEffects[pIndex][pEffect.property]="rgba("+rgb.join(",")+")"}}})}function effectElementGetForProperty(pElement,pProperty,pElementField,pTriggerElement){var selector="";var textProperties=["textColour","fontSize"];var svgProperties=["svgFillColour","svgStrokeColour"];var elementAndChildren=pElement.add(pElement.find("*"));var borderContainer=elementAndChildren.filter(".borderContainer,.blockBorderContainer,.mobileSelectable");var mainImage=borderContainer.find(".fluidHeightRowImage,.backgroundImage,.inlineSVGImage");if("allText"==pElementField){return pElement.find(".textPart")}else if(-1!=pElementField.indexOf("text")){var index=pElementField.substr(4);return pElement.find(".textPart").eq(index)}else if(-1!=pElementField.indexOf("linksInText")){var index=pElementField.substr("linksInText".length);return pElement.find(".textPart").eq(index).find("a")}else if(-1!=$.inArray(pProperty,svgProperties)){return mainImage.find("path")}else if("image"==pElementField&&mainImage.length>0){return mainImage}else if("triggerElement"==pElementField){return pTriggerElement}else if(-1!=$.inArray(pProperty,textProperties)){return pElement.find(".textPart")}return borderContainer}function elementEffectPropertyAndValueProcessForTween(pProperty,pValue){var property=pProperty;var value=pValue;var PROPERTY_MAP={backgroundColour:"backgroundColor",borderRadius:"borderRadius",borderRadiusTopLeft:"borderTopLeftRadius",borderRadiusTopRight:"borderTopRightRadius",borderRadiusBottomLeft:"borderBottomLeftRadius",borderRadiusBottomRight:"borderBottomRightRadius",borderColour:"borderColor",textColour:"color",svgStrokeColour:"stroke",svgFillColour:"fill"};var VALUE_UNIT_MAP={borderWidth:[["px"],"px"],borderRadius:[["px"],"px"],borderRadiusTopLeft:[["px"],"px"],borderRadiusTopRight:[["px"],"px"],borderRadiusBottomLeft:[["px"],"px"],borderRadiusBottomRight:[["px"],"px"],filterBlur:[["px"],"px"],filterBrightness:[["%"],"%"],filterContrast:[["%"],"%"],filterGrayScale:[["%"],"%"],"filterHue-Rotate":[["deg"],"deg"],filterInvert:[["%"],"%"],filterSaturate:[["%"],"%"],filterSepia:[["%"],"%"]};if(pProperty in PROPERTY_MAP){property=PROPERTY_MAP[pProperty]}if(pProperty in VALUE_UNIT_MAP){var units=VALUE_UNIT_MAP[pProperty];value=unitProcess(pValue,units[0],units[1])}if(isFilterProperty(pProperty)){return filterTweenPropertyObjectGet(pProperty,value)}var propertyObject={};propertyObject[property]=value;return propertyObject}function isFilterProperty(pProperty){return"filter"==pProperty.substr(0,6)}function filterTweenPropertyObjectGet(pProperty,pValue){var value=pProperty.substr(6).toLowerCase()+"("+pValue+")";var returnObject={};var filterProperty=cssPropertyAvailablePrefixFind("filter");returnObject[filterProperty]=value;return returnObject}function cssPropertyAvailablePrefixFind(pProperty){var prefixes=["","-webkit-","-moz-","-o-","-ms-"];for(var i in prefixes){var property=prefixes[i]+pProperty;if(document.body.style[property]!==undefined){return property}else{l(property+" not supported")}}}function filterInitialValueSet(pProperty,applyToElement){var propertyWithoutFilterPrefix=pProperty.substr(6).toLowerCase();var DEFAULTS={blur:"0px",brightness:"100%",contrast:"100%",grayscale:"0%","hue-rotate":"0deg",invert:"0%",saturate:"100%",sepia:"0%"};var value=0;if(propertyWithoutFilterPrefix in DEFAULTS){value=DEFAULTS[propertyWithoutFilterPrefix]}var value=filterTweenPropertyObjectGet(pProperty,value);TweenMax.set(applyToElement,value)}