$(document).ready(function(){if($(".xdebug-error").length>0){l($(".xdebug-error *").text())}});function htmlDecode(pHtml){var doc=$.parseHTML(pHtml);if(doc){return doc[0].textContent}return null}function sessionRefreshInit(){var seconds=$("#sessionLifetime").attr("class");var ms=seconds*1e3;setTimeout(function(){location.reload()},ms)}function selectorGetFromStringOrSelector(pStringOrSelector){if("string"==typeof pStringOrSelector){return $(pStringOrSelector)}return pStringOrSelector}function elementBottom(pSelector){return $(pSelector).offset().top+$(pSelector).outerHeight()}function timeGet(){var date=new Date;return date.getTime()}function elementHasAttribute(pElement,pAttribute){return pElement.is("["+pAttribute+"]")}function backgroundImageUrlGet(pElement){var backgroundImage=pElement.css("background-image");if("none"==backgroundImage){return"none"}backgroundImage=backgroundImage.substr("url(".length);backgroundImage=backgroundImage.substr(0,backgroundImage.length-1);backgroundImage=trim(backgroundImage,'"');return backgroundImage}function trim(s,mask){while(~mask.indexOf(s[0])){s=s.slice(1)}while(~mask.indexOf(s[s.length-1])){s=s.slice(0,-1)}return s}function locationGetFromIP(pSuccess,pFail){$.ajax({dataType:"json",url:"http://freegeoip.net/json/",success:function(pData){pSuccess&&pSuccess(pData)},error:function(){pFail&&pFail()},timeout:3e3})}function tabletAndSmaller(){return $("#mediaMatcher").css("float")!="none"}function tablet(){return $("#mediaMatcher").css("float")=="left"}function mobile(){return $("#mediaMatcher").css("float")=="right"}function screenSizeGet(){if(!tabletAndSmaller()){return"desktop"}else if(tablet()){return"tablet"}else{return"mobile"}}function screenWidthGet(){return $(window).width()}function screenHeightGet(){return $(window).height()}function osIsApple(){return navigator.platform.match(/(Mac|iPhone|iPod|iPad)/i)?true:false}function osIsAndroid(){var ua=navigator.userAgent.toLowerCase();return ua.indexOf("android")>-1}function osIsWindows(){return navigator.platform.indexOf("Win")>-1}var hexDigits=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");function rgb2hex(rgb){rgb=rgb.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+hex(rgb[1])+hex(rgb[2])+hex(rgb[3])}function hexToRgb(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)]:null}function hex(x){return isNaN(x)?"00":hexDigits[(x-x%16)/16]+hexDigits[x%16]}function localStorageValueSet(pKey,pValue){console.log("Setting "+pKey+" to "+pValue);localStorage[localStorageKeyGet(pKey)]=pValue}function localStorageValueGet(pKey){var key=localStorageKeyGet(pKey);if(key in localStorage){return localStorage[key]}return null}function localStorageValueRemove(pKey){localStorage.removeItem(localStorageKeyGet(pKey))}function localStorageKeyGet(pKey){return location.pathname+":"+pKey}function domClimbTo(pElement,pTargetSelector){var parent=pElement.parent();if(0==parent.length){return null}if(parent.is(pTargetSelector)){return parent}return domClimbTo(parent,pTargetSelector)}function elementIsHidden(pElement){if(pElement.is("body")){return false}if("none"==pElement.css("display")){return true}return elementIsHidden(pElement.parent())}function elementIsInViewport(pElement){var elementTop=pElement.offset().top;var elementBottom=elementTop+pElement.outerHeight();var screenBottom=$(window).scrollTop()+$(window).height();if(elementTop<screenBottom&&elementBottom>$(window).scrollTop()){return true}return false}function maxInArrayGet(pArray){return Math.max.apply(null,pArray)}function colourPickersInit(){$(".colourPicker, .colourPickerHex").off("change");$(".colourPicker").on("change",function(){var thisVal=$(this).val();var otherVal=$(this).next().val();if(thisVal!=otherVal){$(this).next().val($(this).val())}});$(".colourPickerHex").on("change",function(){var thisVal=$(this).val();var otherVal=$(this).next().val();if(thisVal!=otherVal){$(this).prev().val($(this).val())}})}function browserIsIE(){var ua=window.navigator.userAgent;var msie=ua.indexOf("MSIE ");if(msie>0){return true}var trident=ua.indexOf("Trident/");if(trident>0){var rv=ua.indexOf("rv:");return true}var edge=ua.indexOf("Edge/");if(edge>0){return true}return false}
var gTopBarShrunk=false;var gMobileMenuOut=false;var gOriginalDesktopTopBar=null;var gSHRINK_SCROLL_TOP=250;$(document).ready(function(){mobileToggleButtonInit()});function mobileToggleButtonInit(){var menuSlide=$(".menuSlide");var toggleButton=$("#mobileMenuToggle");toggleButton.on("touchstart",function(){if(gMobileMenuOut){TweenMax.to(menuSlide,.5,{y:-216,onComplete:overlayCheck});gMobileMenuOut=false}else{TweenMax.to(menuSlide,.5,{y:0,onComplete:overlayCheck});gMobileMenuOut=true}})}function overlayCheck(){overlaysRefresh&&overlaysRefresh()}function mobileMenuIsActive(){return"left"==$("#mobileTopBarMediaCheck").css("float")}
var VIDEO_ASPECT_RATIO=.5625;var gFB_RESIZE_DELAY=1e3;var gFBResizeInterval=null;var gCarouselResizeFlag=false;var gPreviousScreenWidth=0;var gPreviousScreenHeight=0;$(document).ready(function(){responsiveInit();videosResize();carouselsInit();slideshowInit();animatedGradientsInit();clickThroughsInit();facebookRefresh();togglesInit();$(window).resize(layoutResize);$(window).scroll(layoutScroll);parallaxUpdate();attachedRowsUpdate();setInterval(function(){facebookRefresh(true)},100)});function backgroundParallaxUpdate(){var scrollTop=$(window).scrollTop();var screenHeight=$(window).height();var screenBottom=scrollTop+screenHeight;$("[data-background-parallax-velocity]").each(function(){var row=$(this);if(!row.data("initialBackgroundPositionY")){row.data("initialBackgroundPositionY",row.css("background-position-y"))}var rowTop=row.offset().top;var rowHeight=row.outerHeight();var rowBottom=rowTop+rowHeight;var initialY=row.data("initialBackgroundPositionY");if(rowTop<screenBottom){var velocity=row.data("background-parallax-velocity");var rowEntryPoint=rowTop-screenHeight;rowEntryPoint=Math.max(0,rowEntryPoint);var rowExitPoint=rowBottom;var scrollTopMax=$(document).height()-screenHeight;rowExitPoint=Math.min(scrollTopMax,rowExitPoint);var progressInPx=scrollTop-rowEntryPoint;var progressFraction=progressInPx/(rowExitPoint-rowEntryPoint);var backgroundSize=row.css("background-size");if(-1!=backgroundSize.indexOf("%")&&parseFloat(backgroundSize)<100){}if(velocity<0){var invertedFraction=1-progressFraction*-velocity;var backgroundY=Math.round(invertedFraction*100)}else{var backgroundY=Math.round(progressFraction*100*velocity)}var offset=backgroundPositionConvertToNumber(initialY);if(-1!=offset.indexOf("%")){backgroundY+=parseFloat(offset)}else{var percentage=parseFloat(offset)/rowHeight*100;backgroundY+=percentage}console.log(row.attr("id")+": "+"Y:"+backgroundY);row.css("background-position-y",backgroundY+"%")}})}function rowParallaxUpdate(){if(mobileLayout()){return}var scrollTop=$(window).scrollTop();var screenHeight=$(window).height();var screenBottom=scrollTop+screenHeight;$("[data-row-parallax-velocity]").each(function(){var row=$(this);var initialTop=row.data("row-top");var pauseAt=row.data("row-pause-at");var velocity=row.data("row-parallax-velocity");var scrollTopMax=$("#bodyInner").outerHeight()-screenHeight;var progressFraction=scrollTop/scrollTopMax;var displacementInPx=progressFraction*velocity*scrollTopMax;console.log("Desktop Layout: "+$("#bodyInner").outerHeight());console.log("Progress: "+progressFraction);console.log("Displacement: "+displacementInPx);if(-1!=initialTop.indexOf("vh")||-1!=initialTop.indexOf("%")){var startPosInPx=parseFloat(initialTop)*screenHeight/100}else{var startPosInPx=parseFloat(initialTop)}var actualScreenPosInPx=startPosInPx+displacementInPx;console.log("Screen Pos: "+actualScreenPosInPx);if("undefined"!==typeof pauseAt){var pauseAtInPx=parseFloat(pauseAt)*screenHeight/100;var diff=actualScreenPosInPx-pauseAtInPx;console.log("Diff: "+diff);console.log("Pause at in px: "+pauseAtInPx);if(velocity>0&&diff>0){displacementInPx=displacementInPx-diff}else if(velocity<0&&diff<0){displacementInPx=displacementInPx-diff}}TweenLite.set(row,{y:displacementInPx+"px"})})}function parallaxUpdate(){backgroundParallaxUpdate();rowParallaxUpdate()}function attachedRowsUpdate(){$("[data-attached-to-row]").each(function(){var row=$(this);var attachedToRowName=row.data("attached-to-row");var attachedToRow=$('[data-row-name="'+attachedToRowName+'"]');if(attachedToRow.length>0){var attachedToRowBottom=parseInt(attachedToRow.css("top"))+attachedToRow.height();row.css("top",attachedToRowBottom);var transform=attachedToRow.css("transform");TweenLite.set(row,{transform:transform})}})}function backgroundPositionConvertToNumber(pPosition){if("center"==pPosition){return"50%"}else if("top"==pPosition){return"0%"}else if("bottom"==pPosition){return"100%"}return pPosition}function editorIsActive(){return typeof gEditorLoaded!=="undefined"}function togglesInit(){$("[class]").each(function(){var element=$(this);var classAttr=element.attr("class");if(!classAttr){return true}var classes=classAttr.split(" ");$.each(classes,function(pIndex,pClass){if(-1!=pClass.indexOf("toggle-")){var targetClass=pClass.substr(7);var targetElement=$("."+targetClass);if(targetElement.length>0){var elementAndDescendants=element.find("*");elementAndDescendants.addClass("clickable");if(!editorIsActive()){var url=location.href;var hide=true;if(-1!=url.indexOf("#")){var parts=url.split("#");var linkSelector="#"+parts[parts.length-1];if(targetClass==parts[parts.length-1]){hide=false}}if(hide){targetElement.hide()}}elementAndDescendants.click(function(){targetElement.css("opacity",1);targetElement.slideToggle();return false})}}})})}function layoutScroll(){parallaxUpdate();attachedRowsUpdate()}function clickThroughsInit(){$(".clickThrough").on("click touchstart",function(pEvent){var clickedElement=$(this);var elementBehind=inputBehindGet(pEvent,clickedElement);if(elementBehind){if(elementBehind.is("button")){var form=domClimbTo(elementBehind,"form");elementBehind.trigger(pEvent.type)}else{elementBehind.focus()}}});$(".clickThrough").mousemove(function(pEvent){var element=$(this);clickThroughCursorCheck(pEvent,element)})}function clickThroughCursorCheck(pEvent,pElement){var clickableElements="input, select, button, textarea, label";var inputBehind=inputBehindGet(pEvent,pElement);if(inputBehind.is(clickableElements)){if(inputBehind.is("button")){pElement.css("cursor","pointer");inputBehind.addClass("clickThroughHover");console.log(pElement.attr("class"))}else{pElement.css("cursor","text");$(".clickThroughHover").removeClass("clickThroughHover")}}else{pElement.css("cursor","default");$(".clickThroughHover").removeClass("clickThroughHover")}}function inputBehindGet(pEvent,pElement){console.log(pElement.attr("class"));var rowWrapper=domClimbTo(pElement,".rowWrapper");rowWrapper.hide();if("touchstart"==pEvent.type){pEvent=pEvent.originalEvent.touches[0]}var elementBehind=$(document.elementFromPoint(pEvent.clientX,pEvent.clientY));rowWrapper.show();var clickableElements="input, select, button, textarea, label";if(elementBehind.length==0){return null}return elementBehind}function animatedGradientsInit(){$("[data-animatedGradientColours]").each(function(){var element=$(this);var coloursAttribute=element.attr("data-animatedGradientColours");var colours=$.parseJSON(coloursAttribute);if(colours.length<4){return true}element.data("animatedGradientStep",0);element.data("animatedGradientIndices",[0,1,2,3]);if(element.data("interval")){clearInterval(interval)}var interval=setInterval(function(){updateGradient(element)},10);element.data("interval",interval)})}function updateGradient(pElement){var step=pElement.data("animatedGradientStep");var colourIndices=pElement.data("animatedGradientIndices");var coloursAttribute=pElement.attr("data-animatedGradientColours");var speedAttribute=pElement.attr("data-animatedGradientSpeed");var gradientSpeed=parseFloat(speedAttribute)/1e3;var hexColours=$.parseJSON(coloursAttribute);var rgbaColours=[];$.each(hexColours,function(pIndex,pColour){var rgbColour=hexToRgb(pColour);rgbaColours.push(rgbColour)});if(!colourIndices){return}var c0_0=rgbaColours[colourIndices[0]];var c0_1=rgbaColours[colourIndices[1]];var c1_0=rgbaColours[colourIndices[2]];var c1_1=rgbaColours[colourIndices[3]];var istep=1-step;var r1=Math.round(istep*c0_0[0]+step*c0_1[0]);var g1=Math.round(istep*c0_0[1]+step*c0_1[1]);var b1=Math.round(istep*c0_0[2]+step*c0_1[2]);var color1="rgb("+r1+","+g1+","+b1+")";var r2=Math.round(istep*c1_0[0]+step*c1_1[0]);var g2=Math.round(istep*c1_0[1]+step*c1_1[1]);var b2=Math.round(istep*c1_0[2]+step*c1_1[2]);var color2="rgb("+r2+","+g2+","+b2+")";pElement.css({background:"-webkit-gradient(linear, left top, right top, from("+color1+"), to("+color2+"))"}).css({background:"-moz-linear-gradient(left, "+color1+" 0%, "+color2+" 100%)"});step+=gradientSpeed;if(step>=1){step%=1;colourIndices[0]=colourIndices[1];colourIndices[2]=colourIndices[3];colourIndices[1]=(colourIndices[1]+Math.floor(1+Math.random()*(rgbaColours.length-1)))%rgbaColours.length;colourIndices[3]=(colourIndices[3]+Math.floor(1+Math.random()*(rgbaColours.length-1)))%rgbaColours.length}pElement.data("animatedGradientStep",step);pElement.data("animatedGradientIndices",colourIndices)}function flexSet(pElement,pFlexValue){pElement.css("flex",pFlexValue);pElement.css("-webkit-box-flex",pFlexValue);pElement.css("-moz-box-flex",pFlexValue);pElement.css("-webkit-flex",pFlexValue);pElement.css("-ms-flex",pFlexValue)}function layoutResize(){console.log("Layout Resize");if($(window).width()==gPreviousScreenWidth&&$(window).height()==gPreviousScreenHeight){return}gPreviousScreenWidth=$(window).width();gPreviousScreenHeight=$(window).height();responsiveRefresh();videosResize();facebookRefresh();carouselReset();attachedRowsUpdate();gCarouselResizeFlag=true}function responsiveInit(){$(".flexRow").each(function(){var row=$(this);var firstColumn=row.find(".flexColumn");var margin=firstColumn.css("margin-right");row.data("originalMargin",firstColumn.css("margin-right"))});responsiveRefresh()}function responsiveRefresh(){$("[data-hide]").each(function(){var element=$(this);var hide=htmlDecode(element.attr("data-hide"));var screenWidth=$(window).width();if("<="==hide.substr(0,2)){var number=hide.substr(2);if(screenWidth<=number){elementHideResponsive(element)}else{elementShowResponsive(element)}}else if("<"==hide.substr(0,1)){var number=hide.substr(1);if(screenWidth<number){elementHideResponsive(element)}else{elementShowResponsive(element)}}else if(">="==hide.substr(0,2)){var number=hide.substr(2);if(screenWidth>=number){elementHideResponsive(element)}else{elementShowResponsive(element)}}else if(">"==hide.substr(0,1)){var number=hide.substr(1);if(screenWidth>number){elementHideResponsive(element)}else{elementShowResponsive(element)}}});rolloversRefreshWhenReady()}function rolloversRefreshWhenReady(){if(typeof rolloversRefresh!==typeof undefined){rolloversRefresh()}else{setTimeout(rolloversRefreshWhenReady,1e3)}}function elementShowResponsive(pElement){originalDisplayStore(pElement);var display=pElement.data("originalDisplay");pElement.css("display",display);pElement.find(".layoutSquare").data("responsiveHidden",false);rowMarginsRefresh()}function originalDisplayStore(pElement){var originalDisplay=pElement.data("originalDisplay");if(!originalDisplay){pElement.data("originalDisplay",pElement.css("display"))}}function elementHideResponsive(pElement){originalDisplayStore(pElement);pElement.css("display","none");pElement.data("responsiveHidden",true);pElement.find(".layoutSquare").data("responsiveHidden",true);rowMarginsRefresh();console.l}function rowMarginsRefresh(){$(".flexRow").each(function(){var row=$(this);var columns=row.children();if(columns.length<=1){return true}columns.each(function(pIndex,pColumn){var column=$(this);var margin=row.data("originalMargin");if(0==pIndex){column.css("margin-right",margin)}else if(columns.length-1==pIndex){column.css("margin-left",margin)}else{column.css("margin-left",margin);column.css("margin-right",margin)}})})}function mobileLayout(){return"right"==$("#layoutMediaQuery").css("float")}function desktopLayout(){return"left"==$("#layoutMediaQuery").css("float")}function slideshowInit(){if(browserIsIE()){}gSlideshowInterval=setTimeout(function(){$(".block-slideshow").each(function(){var block=$(this);var timeline=block.data("timeline");if(timeline){timeline.kill()}nextSlideshowImageAnimateRecursive(block,block.find(".slideShowImage").last(),true)})},3e3)}function nextSlideshowImageAnimateRecursive(pBlock,pImage,pFirst){var elementId=pBlock.attr("data-id");var interval=gElementData[elementId];var timeline=new TimelineLite;pBlock.data("timeline",timeline);var callback=function(){var prevImage=pImage.prev();if(!prevImage.is("script")){prevImage.css("opacity",1);nextSlideshowImageAnimateRecursive(pBlock,prevImage,false)}};if(pFirst){if(browserIsIE()){timeline.to(pImage,interval*.9,{onComplete:callback})}else{timeline.to(pImage,interval*.9,{scale:1.2,rotation:.01,onComplete:callback,ease:Power0.easeNone})}}else{if(browserIsIE()){timeline.to(pImage,interval*.9,{onComplete:callback})}else{timeline.to(pImage,interval*.1,{scale:1.1,rotation:.01});timeline.to(pImage,interval*.8,{scale:1.2,rotation:.01,ease:Power0.easeNone,onComplete:callback})}}var opacityTransition=.1;if(browserIsIE()){opacityTransition=.5}timeline.to(pImage,interval*opacityTransition,{opacity:0,onComplete:function(){pBlock.find("script").after(pImage);TweenLite.set(pImage,{scale:1,rotation:.01})}})}function facebookRefresh(pScroll){var facebookBlocks=$(".desktopLayout .block-facebook");if(mobileLayout()){var facebookBlocks=$(".mobileLayout .block-facebook")}facebookBlocks.each(function(){var block=$(this);var row=domClimbTo(block,".flexRow");var column=domClimbTo(block,".flexColumn");if(!elementIsInViewport(block)){return}var elementId=block.attr("data-id");var data=gElementData[elementId];var urlEnd=data.url;if(""==urlEnd){return}var previousIFrame=block.find("iframe");if(previousIFrame.length>0&&pScroll){return}block.empty();var width=parseInt(block.innerWidth());width=Math.min(width,500);var height=500;if(column){var heightPercentage=parseFloat(data.height);var height=column.height()*heightPercentage/100}height=parseInt(height);var baseUrl="https://www.facebook.com/plugins/page.php";var params="href=https%3A%2F%2Fwww.facebook.com%2F"+urlEnd+"&width="+width+"&height="+height+"&tabs=timeline&small_header=false&adapt_container_width=true&hide_cover=false&show_facepile=true&appId=390487257738943";var widthAttr='width="'+width+'" ';var heightAttr='height="'+height+'" ';var attr=widthAttr+heightAttr+'style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowTransparency="true"';var iframe=$('<iframe src="'+baseUrl+"?"+params+'" '+attr+"></iframe>");block.append(iframe);iframe.data("currentWidth",width);iframe.data("currentHeight",height)})}function carouselDotsInit(){$(".carouselDot").unbind();$(".carouselDot").click(function(){var dot=$(this);var imageWrapper=dot.parent().parent().find(".carouselImageWrapper");var index=dot.prevAll().length;carouselAnimateToPos(imageWrapper,index);clearInterval(imageWrapper.data("interval"))})}function carouselReset(){var imageWrappers=$(".block-carousel .carouselImageWrapper");imageWrappers.each(function(){var wrapper=$(this);var tween=wrapper.data("tween");if(tween){tween.kill();wrapper.removeData("tween")}});TweenLite.set(imageWrappers,{x:0});carouselsInit()}function carouselsInit(){carouselDotsInit();var imageWrappers=$(".block-carousel .carouselImageWrapper");imageWrappers.each(function(){var wrapper=$(this);wrapper.data("imageCount",wrapper.find(".carouselImage").length);wrapper.data("pos",0)});imageWrappers.each(function(){var wrapper=$(this);var intervalTimeMs=wrapper.attr("data-interval")*1e3;var previousInterval=wrapper.data("intervalId");if(previousInterval){clearInterval(previousInterval)}var interval=setInterval(function(){var images=wrapper.find(".carouselImage");var nextImageIndex=wrapper.data("pos")+1;if(nextImageIndex==images.length){nextImageIndex=0}var nextImage=images.eq(nextImageIndex);if(imageIsLoaded(nextImage)){nextImage.css("display","inline");console.log("Image loaded - animating");carouselAnimateToPos(wrapper,wrapper.data("pos")+1)}else{console.log("Image not loaded - will try again soon")}},intervalTimeMs);wrapper.data("intervalId",interval)})}function imageIsLoaded(pImage){return pImage.data("loaded")}function carouselAnimateToPos(pImageWrapper,pPos){var dots=pImageWrapper.parent().find(".carouselDot");dots.removeClass("current");var width=pImageWrapper.width();var images=pImageWrapper.find(".carouselImage");var translation=pPos*-width;if(pPos==images.length){pImageWrapper.append(images.eq(0).clone(true,true));images=pImageWrapper.find(".carouselImage");dots.eq(0).addClass("current")}else{dots.eq(pPos).addClass("current")}var tween=TweenLite.to(pImageWrapper,1,{x:translation,onComplete:function(){var imageCount=pImageWrapper.data("imageCount");if(images.length>imageCount){images.slice(imageCount).remove();TweenLite.set(pImageWrapper,{x:0});pImageWrapper.data("pos",0)}pImageWrapper.removeData("tween")}});pImageWrapper.data("pos",pPos);pImageWrapper.data("tween",tween)}function videosResize(){$(".block-vimeo, .block-youtube").find(".videoWrapper.crop").each(function(){var wrapper=$(this);var iframe=wrapper.find("iframe");wrapper.css("overflow","hidden");wrapper.css("position","relative");iframe.css("position","absolute");var elementWidth=wrapper.width();var elementHeight=wrapper.height();var videoWidth=elementWidth;var videoHeight=elementWidth*VIDEO_ASPECT_RATIO;if(videoHeight<elementHeight){videoHeight=elementHeight;videoWidth=videoHeight/VIDEO_ASPECT_RATIO}if(videoWidth>elementWidth){var left=-(videoWidth-elementWidth)/2;iframe.css("left",left);console.log("h adjust");console.log("width="+videoWidth)}else if(videoHeight>elementHeight){console.log("v adjust");console.log("height="+videoHeight)}iframe.width(videoWidth).height(videoHeight)})}
$(window).on("load",function(){});function rolloversRefresh(){console.log("Rollovers Refresh");$(".overlayRemove").remove();if(mobileLayout()){$(".rolloverImage").css("visibility","visible")}else{allImagesOverlayAdd()}}function overlaysAddToRow(pRowWrapper){pRowWrapper.find("a.rolloverImage .borderContainerWithBackgroundImage").each(function(){imageOverlayAdd($(this))})}function allImagesOverlayAdd(){$("a.rolloverImage").each(function(){var borderContainer=$(this).children(".borderContainerWithBackgroundImage");imageOverlayAdd(borderContainer)})}function imageOverlayAdd(pImage){var originalImage=backgroundImageUrlGet(pImage);if("none"==originalImage){return}var element=domClimbTo(pImage,".layoutSquare");if(elementIsHidden(pImage)||element.data("responsiveHidden")){return}var overlay=$('<div class="overlayRemove overlayWrapper">');dimensionsCopy(pImage,overlay);overlay.css("border",pImage.css("border"));overlay.css("overflow","hidden");pImage.css("visibility","hidden");var overlayImage=$('<img src="'+originalImage+'" class="overlayImage">').appendTo(overlay);overlay.appendTo("body");var overlayAspectRatio=pImage.width()/pImage.height();var imageAspectRatio=overlayImage.width()/overlayImage.height();if(imageAspectRatio>overlayAspectRatio){overlayImage.height(pImage.height());overlayImage.addClass("tallImage")}else{overlayImage.width(pImage.width());overlayImage.addClass("longImage")}overlayImage.remove();overlay.append(overlayImage);var darkCover=$('<div class="overlayRemove darkCover">').appendTo("body");dimensionsCopy(overlay,darkCover);darkCover.addClass("darkCover");var newTextWrapper=$('<div class="overlayRemove overlayTextOuter">').appendTo("body");dimensionsCopy(overlay,newTextWrapper);var textInner=$('<div class="overlayTextInner">').appendTo(newTextWrapper);var originalTextWrapper=pImage.find(".customTextWrapper");textInner.append(originalTextWrapper.html());var classes=originalTextWrapper.attr("class").split(" ");for(var i in classes){var className=classes[i];if(-1!=className.indexOf("verticalAlign")){textInner.addClass(className)}}newTextWrapper.click(function(){window.location=pImage.parent().attr("href")});pImage.data("overlayImage",overlayImage);pImage.data("overlayCover",darkCover);newTextWrapper.hover(function(){overlayImage.addClass("hover");darkCover.addClass("hover");newTextWrapper.addClass("hover")},function(){overlayImage.removeClass("hover");darkCover.removeClass("hover");newTextWrapper.removeClass("hover")})}function dimensionsCopy(pSourceElement,pDestinationElement){pDestinationElement.css("position","absolute");pDestinationElement.css("width",pSourceElement.outerWidth());pDestinationElement.css("height",pSourceElement.outerHeight());pDestinationElement.css("left",pSourceElement.offset().left);pDestinationElement.css("top",pSourceElement.offset().top)}
function elementTextEffectStart(pElement,pName,pData,pIgnoreDelay){gEFFECTS[pName].function(pElement,pData,pIgnoreDelay)}function fallAndFadeStart(pElement,pData,pIgnoreDelay){TweenLite.from(pElement,pData.duration,{ease:Bounce.easeOut,y:"-100%",opacity:0})}function textFadeStart(pElement,pData,pIgnoreDelay){TweenLite.from(pElement,pData.duration,{opacity:0})}
$(document).ready(function(){console.log("Image loader ready");allImagesLoadCheck(true);$(window).scroll(allImagesLoadCheckAll);$(window).resize(allImagesLoadCheckAll)});function allImagesLoadCheckAll(){allImagesLoadCheck(false)}function imageLoaderResizeRefresh(){}function allImagesLoadCheck(pOmitFirst){if(typeof gEditorLoaded!=="undefined"){$(".rootRowWrapper").each(function(){var wrapper=$(this);if(0==wrapper.css("opacity")){wrapper.css("opacity",1)}});if(desktopLayout()){var interval=null;imagesLoadCheck($(".desktopLayout"),false,function(){if(allImagesAreLoaded($(".desktopLayout"))){if(interval){clearInterval(interval)}interval=setTimeout(rolloversRefresh,1e3)}editorResizeRefresh()})}else{imagesLoadCheck($(".mobileLayout"),false,function(){editorResizeRefresh()})}}else{if(desktopLayout()){nextRowLoad(pOmitFirst,true);firstRowStaggeredImageLoadCheck()}else{var mobileImages=$(".mobileLayout").find("[data-imageSrc]");if(pOmitFirst){mobileImages=$(".mobileSelectable").slice(1).find("[data-imageSrc]")}else{var firstElement=$(".mobileSelectable").eq(0);if(firstElement.length>0){if(firstElement.find("data-imageSrc").length==0){TweenLite.to(firstElement,1,{opacity:1})}}}mobileImages.each(function(){var image=$(this);if(!image.data("loaded")){image.css("opacity",0)}});imagesLoadCheck(mobileImages,false,function(pLoadedElement){var parent=domClimbTo(pLoadedElement,".mobileSelectable");if(parent&&0==parent.css("opacity")){pLoadedElement.css("opacity",1);TweenLite.to(parent,1,{opacity:1})}else{TweenLite.to(pLoadedElement,1,{opacity:1})}});mobileStaggeredImageLoadCheck()}}}function unattachedImagesLoad(){}function rowWrapperSelectorGet(pOmitFirst){var selector=$(".desktopLayout .rowWrapper, .desktopShow.imageLoadRow");if(mobileLayout()){selector=$(".mobileLayout .rowWrapper, .mobileShow.imageLoadRow")}if(pOmitFirst){return selector.slice(1)}return selector}function nextRowLoad(pOmitFirst){var allRowWrappers=rowWrapperSelectorGet(pOmitFirst);var elements=[];$.each(allRowWrappers,function(pIndex,pElement){var wrapper=$(this);if(elementIsInViewport(wrapper)){elements.push(pElement)}});$.each(allRowWrappers,function(pIndex,pElement){var wrapper=$(this);if(!elementIsInViewport(wrapper)){elements.push(pElement)}});$.each(elements,function(pIndex,pRow){var row=$(pRow);if(row.data("loading")){return false}if(elementIsHidden(row)){return true}if(rowHasNoImages(row)){if("fadedIn"==row.data("FADE_STATE")){return true}row.data("FADE_STATE","fadingIn");rowFadeIn(row,function(){row.data("FADE_STATE","fadedIn");nextRowLoad(pOmitFirst)});return false}if(allImagesAreLoaded(row)){return true}row.data("loading",true);var imageCount=0;imagesLoadCheck(row,false,function(){if(allImagesAreLoaded(row)){if(elementIsInViewport(row)){rowFadeIn(row);setTimeout(function(){row.data("loading",false);nextRowLoad(pOmitFirst)},100)}else{rowFadeIn(row);row.data("loading",false);nextRowLoad(pOmitFirst)}}});return false})}function rowHasNoImages(pRowWrapper){return imagesSelectorGet(pRowWrapper).length==0}function rowFadeIn(pRowWrapper,pCallback){var timeline=new TimelineLite({onComplete:function(){overlaysAddToRow(pRowWrapper);pCallback&&pCallback()}});var startTime=0;timeline.to(pRowWrapper,1,{opacity:1});var images=pRowWrapper.find("[data-imageSrc]");startTime+=.2;images.each(function(){var image=$(this);var fadeElement=domClimbTo(image,".layoutSquare,.block");if(!fadeElement){fadeElement=image}if(fadeElement.hasClass("noFade")){return}var targetOpacity=1;if(fadeElement.is(".rowLayer")){targetOpacity=fadeElement.css("opacity")}fadeElement.css("opacity",0);timeline.to(fadeElement,1,{opacity:targetOpacity},startTime);startTime+=.2})}function allImagesAreLoaded(pSelector){var allLoaded=true;imagesSelectorGet(pSelector).each(function(){var element=$(this);var hidden=elementIsHidden(element);if(!elementIsHidden(element)&&!element.data("loaded")){allLoaded=false}});return allLoaded}function imagesSelectorGet(pContainer){var selector=pContainer.find("[data-imageSrc]");if(pContainer.is("[data-imageSrc]")){selector=selector.add(pContainer)}return selector}function imagesLoadCheck(pSelector,pCheckViewPort,pImageLoadedCallback){var selector=imagesSelectorGet(pSelector);selector.each(function(){var element=$(this);if(element.data("loaded")){return}if(elementIsHidden(element)){console.log("Element is hidden");return}if(pCheckViewPort&&!elementIsInViewport(element)){return}imageLoad(element,"data-imageSrc",pImageLoadedCallback)})}function imageLoad(pImageElement,pDataAttribute,pImageLoadedCallback){var url=pImageElement.attr(pDataAttribute);if(pImageElement.is("img")){console.log("Loading Image: "+url);pImageElement.on("load",function(){if(pImageElement.data("loaded")){return}pImageElement.data("loaded",true);pImageElement.css("padding-bottom",0);pImageLoadedCallback&&pImageLoadedCallback(pImageElement);staggeredImageLoadCheck(pImageElement);console.log("Image Loaded: "+url)});pImageElement.attr("src",url)}else{console.log("Loading Background Image: "+url);var dummyImage=$('<img src="'+url+'" >');dummyImage.on("load",function(){if(pImageElement.data("loaded")){return}pImageElement.css("background-image","url("+url+")");pImageElement.data("loaded",true);pImageLoadedCallback&&pImageLoadedCallback(pImageElement);staggeredImageLoadCheck(pImageElement);console.log("Background Image Loaded"+url)})}}function mobileStaggeredImageLoadCheck(){var staggeredImages=$(".mobileLayout").find("[data-image-src-staggered]");if(staggeredImages.length>0){staggeredImageLoadCheck(staggeredImages.eq(0))}}function firstRowStaggeredImageLoadCheck(){var rows=rowWrapperSelectorGet();var firstRow=rows.eq(0);var staggeredImages=firstRow.find("[data-image-src-staggered]");if(staggeredImages.length>0){staggeredImageLoadCheck(staggeredImages.eq(0))}}function staggeredImageLoadCheck(pTriggerImage){var staggeredImages=pTriggerImage.parent().find("[data-image-src-staggered]");staggeredImages.each(function(pImage){var staggeredImage=$(this);if(!staggeredImage.data("loaded")){var delay=staggeredImage.attr("data-image-load-delay");delay=delay?delay:0;console.log("Loading staggered image in "+delay*1e3);setTimeout(function(){console.log("Loading Staggered Image "+staggeredImage.data("image-src-staggered"));imageLoad(staggeredImage,"data-image-src-staggered")},delay*1e3);return false}})}