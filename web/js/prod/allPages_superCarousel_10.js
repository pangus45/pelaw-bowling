var gLastSuperCarouselWidth=null;function superCarouselBlocksInit(){forEachSuperCarouselBlockInCurrentLayout(function(pBlock){superCarouselBlockInit(pBlock)});gLastSuperCarouselWidth=$("html").width()}function superCarouselBlocksInCurrentLayoutGet(){return currentLayoutSelectorGet().find(".selectable.block-superCarousel")}function allSuperCarouselBlocksGet(){return $(".selectable.block-superCarousel")}function forEachSuperCarouselBlock(pCallback){allSuperCarouselBlocksGet().eachElement(function(pBlock){return pCallback(pBlock)})}function forEachSuperCarouselBlockInCurrentLayout(pCallback){superCarouselBlocksInCurrentLayoutGet().eachElement(function(pBlock){return pCallback(pBlock)})}function superCarouselsResize(){l("superCarouselsResize");if(gLastSuperCarouselWidth==$("html").width()){return}superCarouselBlocksInit()}function superCarouselDotCurrentSet(pBlockElement,pIndex){var dots=pBlockElement.find(".carouselDot");dots.removeClass("current");dots.eq(pIndex).addClass("current")}function superCarouselDotsInit(pBlockElement){var dots=pBlockElement.find(".carouselDot");if(0==dots.length){return}dots.unbind();dots.click(function(){var dot=$(this);var index=dot.prevAll().length;superCarouselSlideIntervalClear(pBlockElement);superCarouselAnimateToIndex(pBlockElement,index)})}function superCarouselSlideIntervalClear(pBlockElement){var interval=pBlockElement.data("slideInterval");if(interval){l("Clearing slide interval");clearInterval(interval);pBlockElement.removeData("slideInterval")}}function superCarouselSlideWidthGet(pBlockElement){var borderContainer=pBlockElement.find(".blockBorderContainer");var slideWidth=borderContainer.width();return slideWidth}function superCarouselBlockHtmlStoreCheck(pBlockElement){var html=pBlockElement.data("html");if(html){superCarouselSlideIntervalClear(pBlockElement);pBlockElement.html(html);pBlockElement.removeData();pBlockElement.data("html",html);return}else{l("Not yet initialized - storing original html");pBlockElement.data("html",pBlockElement.html())}}function superCarouselBlockInit(pBlockElement){superCarouselBlockHtmlStoreCheck(pBlockElement);var elementsWrapper=pBlockElement.find(".superCarouselElementsWrapper");var innerWrapper=pBlockElement.find(".superCarouselInnerWrapper");var slideWidth=superCarouselSlideWidthGet(pBlockElement);l("Slide Width 1",slideWidth);var clonedSlides=elementsWrapper.find(".superCarouselElement").clone();if(0==clonedSlides.length){return}clonedSlides.eachIndexAndElement(function(pIndex,pElement){pElement.attr("data-index",pIndex)});elementsWrapper.empty();var initialSlideCount=clonedSlides.length;if(0==initialSlideCount){return}var screenToSlideRatio=$("html").width()/slideWidth;var slidesOnScreen=Math.floor(screenToSlideRatio)+2;var minSlides=Math.max(slidesOnScreen*4,initialSlideCount*4);l("Min Slides!!!",minSlides);l("Cloning superCarousel elements",minSlides);var loop=0;while(elementsWrapper.find(".superCarouselElement").length<minSlides){clonedSlides.each(function(){var slide=$(this);var clonedSlide=slide.clone();if(loop>0){var backgroundImage=clonedSlide.find(".backgroundImage");var layoutSquare=clonedSlide.find(".layoutSquare");layoutSquare.attr("data-id",layoutSquare.attr("data-id")+"-"+loop);backgroundImage.attr("id",backgroundImage.attr("id")+"-"+loop)}elementsWrapper.append(clonedSlide)});loop++}innerWrapper.css("width",slideWidth);var slides=elementsWrapper.find(".superCarouselElement");slides.width(slideWidth);pBlockElement.css("height",pBlockElement.height());innerWrapper.css("width","auto");slides.remove();var newSlideWidth=superCarouselSlideWidthGet(pBlockElement);if(slideWidth!=newSlideWidth){l(slideWidth+" changed to "+newSlideWidth)}elementsWrapper.append(slides);slides.css("width",newSlideWidth);innerWrapper.css("width",newSlideWidth);pBlockElement.css("height","auto");l(innerWrapper.css("height"));if(""!=innerWrapper.css("height")){slides.find(".borderContainer").children().css("height",innerWrapper.css("height"))}var pos=initialSlideCount*2;pBlockElement.data("pos",pos);pBlockElement.data("index",0);pBlockElement.data("initialSlideCount",initialSlideCount);pBlockElement.data("slideWidth",newSlideWidth);imagesLoadCheck(pBlockElement,false,function(){l("Super Carousel image loaded inform")});superCarouselImagesLoadCheck(pBlockElement,function(){var mobile=domClimbTo(pBlockElement,".mobileSelectable");if(mobile&&0==mobile.css("opacity")){l("opacityZero flag used to prevent flash from early load");TweenMax.to(mobile,.5,{opacity:1})}superCarouselAnimsInit(pBlockElement,initialSlideCount);superCarouselDotsInit(pBlockElement);pBlockElement.find(".layoutSquare.hasImage,.backgroundImage").each(function(){var image=$(this);if(1!=image.css("opacity")){l("Image found with 0 opacity - fading in");TweenMax.to(image,.5,{opacity:1})}});if(editorLoaded()){selectionInit()}})}function superCarouselSrcSetForIndex(pBlockElement,pIndex,pUrl){var slides=pBlockElement.find(".superCarouselElement");slides.eachElement(function(pElement){if(pElement.data("index")==pIndex){var image=pElement.find(".fluidHeightRowImage");var backgroundImage=pElement.find(".backgroundImage");l("src",image.attr("src"));l("padding-bottom",image.css("padding-bottom"));if(image.length>0){image.attr("src",pUrl);image.css("padding-bottom","");l("Setting src for "+pIndex)}else if(backgroundImage.length>0&&"none"==backgroundImage.css("background-image")){l("Setting background image for "+pIndex);backgroundImage.css("background-image",pUrl)}}})}function superCarouselImagesLoadCheck(pBlockElement,pCallback){var slides=pBlockElement.find(".superCarouselElement");var allLoaded=true;slides.eachElement(function(pSlideElement){var loaded=superCarouselImageLoadCheck(pSlideElement);if(!loaded){allLoaded=false}});if(allLoaded){l("All loaded");pCallback()}else{l("Not yet loaded");var interval=setTimeout(function(){superCarouselImagesLoadCheck(pBlockElement,pCallback)},1e3)}}function superCarouselImageLoadCheck(pSlideElement){var image=pSlideElement.find(".fluidHeightRowImage");var backgroundImage=pSlideElement.find(".backgroundImage");var index=pSlideElement.data("index");var block=domClimbTo(pSlideElement,".block-superCarousel");if(1==image.length){if(image[0].hasAttribute("src")){superCarouselSrcSetForIndex(block,index,image.attr("src"));image.data("loaded",true);return true}else{return false}}else if(1==backgroundImage.length){l("Background Image",backgroundImage.css("background-image"));if("none"!=backgroundImage.css("background-image")){superCarouselSrcSetForIndex(block,index,backgroundImage.css("background-image"));pSlideElement.data("loaded",true);return true}else{return false}}return true}function superCarouselPosSet(pBlockElement,pPos){pBlockElement.data("pos",pPos);superCarouselWrapperPositionSet(pBlockElement)}function superCarouselWrapperPositionSet(pBlockElement){var pos=pBlockElement.data("pos");var slideWidth=pBlockElement.data("slideWidth");var x=pos*slideWidth;var elementsWrapper=pBlockElement.find(".superCarouselElementsWrapper");TweenMax.set(elementsWrapper,{x:-x});l("Setting pos to "+pos+" and x to "+x)}function superCarouselAnimsInit(pBlockElement,pInitialSlideCount){l("superCarouselAnimsInit");superCarouselWrapperPositionSet(pBlockElement);var forward=true;var slideFunction=function(){var pos=pBlockElement.data("pos");var index=pBlockElement.data("index");var newIndex=forward?index+1:index-1;if("loop"==data.loop&&newIndex>=pInitialSlideCount){newIndex=0}var newPos=forward?pos+1:pos-1;superCarouselAnimateToPos(pBlockElement,newPos,newIndex,function(){slideTimeoutSet(pBlockElement,slideFunction);if("reverse"==data.loop){var endIndex=pInitialSlideCount-1;if(!isNaN(data.reverseAt)){endIndex=data.reverseAt}if(forward&&newIndex==endIndex||!forward&&0==newIndex){forward=!forward}}})};slideTimeoutSet(pBlockElement,slideFunction)}function slideTimeoutSet(pBlockElement,pSlideFunction){var data=elementDataGet(pBlockElement);var intervalMs=parseFloat(data.slideInterval)*1e3;var interval=setTimeout(pSlideFunction,intervalMs);pBlockElement.data("slideInterval",interval)}function superCarouselAnimateToIndex(pBlockElement,pIndex){var currentIndex=pBlockElement.data("index");var currentPos=pBlockElement.data("pos");if(pIndex>currentIndex){var moveForwardBy=pIndex-currentIndex;var newPos=currentPos+moveForwardBy}else if(pIndex<currentIndex){var moveBackBy=currentIndex-pIndex;var newPos=currentPos-moveBackBy}superCarouselAnimateToPos(pBlockElement,newPos,pIndex)}function superCarouselAnimateToPos(pBlockElement,pPos,pIndex,pOnComplete){var moving=pBlockElement.data("moving");if(moving){return}var slideWidth=pBlockElement.data("slideWidth");var elementsWrapper=pBlockElement.find(".superCarouselElementsWrapper");var slides=elementsWrapper.find(".superCarouselElement");var data=elementDataGet(pBlockElement);pBlockElement.data("moving",true);superCarouselDotCurrentSet(pBlockElement,pIndex);var currentPos=pBlockElement.data("pos");var slideCount=slides.length;var halfSlideCount=slideCount/2;var initialSlideCount=pBlockElement.data("initialSlideCount");if(pPos>currentPos){if(pPos>halfSlideCount){l("Moving back");superCarouselPosSet(pBlockElement,currentPos-initialSlideCount);pPos-=initialSlideCount}}var x=slideWidth*pPos;TweenMax.to(elementsWrapper,parseFloat(data.slideDuration),{x:-x,onComplete:function(){pBlockElement.data("pos",pPos);pBlockElement.data("index",pIndex);pOnComplete&&pOnComplete();pBlockElement.data("moving",false)}})}